<script>
    (function(){
        var user_id = {{ app.user.id }};
        var token = "{{ app.user.accessToken }}";
        var api_endpoint = "{{ api_endpoint }}";
        var $messageCounter = $('#num_messages');

        $.Updater(api_endpoint + '/api/users/'+user_id+'/threads/inbox', {interval: '60000', headers: {Authorization: 'Bearer ' + token}}, function(data){
            nonReaded = $(data).filter(function(i, obj){
                return !obj.is_readed;
            });

            $messageCounter.html(nonReaded.length);
        });
    })();
</script>