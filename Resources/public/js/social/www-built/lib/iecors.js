define(["jquery","easyXDM"],function(e){function t(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/");return t>-1||n>-1}(function(e){var n={},r=this,i="before",s=[],o=null,u=null,a=!1;/jquery\.easyXDM\.debug=true/.test(String(window.location))&&(a=!0),a&&e("#log").length==0&&e("body").append('<div id="log"></div>');var f=function(r,i){if(t()){var s=r+"/easyXDM.min.js";a&&(s=r+"/easyXDM.debug.js");function u(){var t=easyXDM.noConflict("jquery_easyXDM");n.easyXDM=t;var s=r+"/cors/index.html",u=e("#jquery_easyXDM_provider_container")[0]||null;a&&(s+="?jquery.easyXDM.debug=true",u||(u=e('<div id="jquery_easyXDM_provider_container"></div>').appendTo(e("body"))[0])),o=new t.Rpc({remote:s,swf:r+"/easyxdm.swf",container:u,onReady:function(){i.success(o)}},{remote:{jquery_proxy:{}}})}e.getScript(s,function(){typeof window["JSON"]!="object"||!window.JSON?e.getScript(r+"/json2.js",u):u()})}};n.getConnection=function(e,t){switch(i){case"before":i="working",s.push(t),f(e,{success:function(e){i="success",o=e;for(var t=0;t<s.length;t++)s[t].success(o);s=[]},failure:function(e){i="failure",u=e;for(var t=0;t<s.length;t++)s[t].failure(u);s=[]}});break;case"working":s.push(t);break;case"success":t.success(o);break;case"failure":t.failure(u);break;default:throw new Error("Invalid state: "+i)}},e.ajaxTransport("+*",function(e,r,i){if(t()){var s=window.api_server,o=e.url.match(/^(https?:\/\/[^\/]*)\/?.*/);return o&&(s=o[1]),{send:function(e,t){n.getConnection(s,{success:function(n){function i(e){t(e.status,e.statusText,e.responses,e.headers)}r.context=null,r.headers=r.headers||{};for(header in e)r.headers[header]=e[header];n.jquery_proxy(r,i)},error:function(){}})},abort:function(){}}}}),r.jquery_easyXDM=n})(e)});