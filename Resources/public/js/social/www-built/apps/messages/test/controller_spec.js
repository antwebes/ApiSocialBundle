define(["apps/messages/index/index_controller","app","apps/messages/test/fixtures","apps/messages/messages_app","util/testutils","jasmine-fixture"],function(e,t,n){return describe("MessagesApp.Controller",function(){var r=function(e){var t=$.Deferred(),n=t.promise();return t.resolve(e),n};beforeEach(function(){e._sendMessage=sinon.spy();var i=r(n.threads.collection),s=r(n.messages.collection);this.parentThread=n.messages.message1.get("thread"),this.stub=sinon.stub(t,"request"),this.stub.withArgs("thread:entities").returns(i),this.stub.withArgs("thread:entities:sent").returns(i),this.stub.withArgs("thread:messages",1).returns(s),t.navigate("social-dinamic/app/SpecRunner.html")}),afterEach(function(){this.stub.restore(),t.navigate("social-dinamic/app/SpecRunner.html")}),describe("Index",function(){it("should show the inbox",function(){e.Index(),expect($(".message-item").length).toEqual(3),expect($(".message-unread").length).toEqual(1),expect($(".message-unread .summary span").html()).toEqual("el titulo del mensaje 1")})}),describe("Sent",function(){it("should show the sended box",function(){e.Sent(),expect($(".message-item").length).toEqual(3),expect($(".message-unread").length).toEqual(1),expect($(".message-unread .summary span").html()).toEqual("el titulo del mensaje 1")})}),describe("ShowThread",function(){beforeEach(function(){this._orgiginalDeleteThread=e._deleteThread,e._deleteThread=sinon.spy(),e.ShowThread(1)}),afterEach(function(){e._deleteThread=this._orgiginalDeleteThread}),it("should request the messegas for the thread from the server",function(){expect(this.stub).toHaveBeenCalledWith("thread:messages",1)}),it("should show the messages of a thread",function(){expect($(".message-item").length).toEqual(2),expect($(".message-unread").length).toEqual(1),expect($(".message-unread .message-body").html()).toEqual("el body 2")}),it("should show a reply button",function(){expect($("#reply").length).toEqual(1)}),it("should show a delete button",function(){expect($("#delete").length).toEqual(1)}),describe("reply button",function(){var e;it("should show a reply form",function(){e=$("#reply"),e.trigger("click"),waitsForPresenceOfDOMElement("span.btn-send-message"),runs(function(){expect($("span.btn-send-message").length).toEqual(1),expect($("#replay-container textarea").length).toEqual(1)})})}),describe("delete button",function(){it("should call the delete controller",function(){$("#delete").trigger("click"),waitsForPresenceOfDOMElement(".modal-dialog"),runs(function(){$(".ok").trigger("click"),expect(e._deleteThread).toHaveBeenCalledWith(this.parentThread)})})}),describe("Write Mail button",function(){var e;beforeEach(function(){}),it("should show the write mail form",function(){e=$("#compose"),e.trigger("click"),waitsForPresenceOfDOMElement("input[name=recipient]"),runs(function(){expect($("input[name=recipient]").length).toEqual(1),expect($("input[name=subject]").length).toEqual(1),expect($("textarea[name=body]").length).toEqual(1),expect($("button#send").length).toEqual(1)})})}),describe("Compose",function(){it("should call the _sendMessage action when the form is filled in and the send button is pressed",function(){e.Compose();var t,n,r,i;waitsForPresenceOfDOMElement("input[name=recipient]"),runs(function(){t=$("input[name=recipient]"),n=$("input[name=subject]"),r=$("textarea[name=body]"),i=$("button#send"),t.val("therecipient"),n.val("thesubject"),r.val("thebody"),i.trigger("click")}),waitsForSpyToBeCalled(e._sendMessage),runs(function(){expect(e._sendMessage).toHaveBeenCalled()})})})})}),{name:"messages_controller_spec"}});