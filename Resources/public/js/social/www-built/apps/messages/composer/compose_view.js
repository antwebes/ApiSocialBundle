define(["app","text!apps/messages/composer/templates/compose.html","text!apps/messages/composer/templates/compose_form.html","backbone-bootstrap","backbone-forms","backbone.autocomplete","entities/messages","handlebars"],function(e,t,n,r,i,s,o,u){function a(e){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}function f(e,t,n){$(t).hide(),$(e).html(""),$(e).removeClass("hide"),$(e).show(),$(e).html(n)}return e.module("MessagesApp.Composer.View",function(e,r,s,l,c,h){var p=null;e.ComposeView=l.ItemView.extend({tagName:"div",template:t,formTemplate:n,events:{"click #send":"submit","click #cancel-send":"back"},initialize:function(e){this.template=u.compile(this.template),this.model.on("error",this.onError,this),e.formTemplate&&(this.formTemplate=e.formTemplate)},onRender:function(){a(require.toUrl("backbone_autocomplete_css")),p=new i({model:this.model,template:u.compile(this.formTemplate)}),this.$el.find(".compose-wrapper").html(p.render().el);var e=new o.RecipientsCollection;return setTimeout(function(){(new AutoCompleteView({input:c("#form-field-recipient"),model:e})).render()},100),this},submit:function(){var e=p.commit({validate:!0});typeof e=="undefined"&&(f(this.$el.find("#alert-success"),this.$el.find("#alert-danger"),"Sending messsage..."),this.trigger("compose:submit",this.model))},back:function(e){return e.preventDefault(),e.stopPropagation(),this.trigger("compose:back"),!1},onError:function(e,t,n){var r=this,i="";t.responseJSON!==undefined?response=t.responseJSON:response=JSON.parse(t.responseText),response.code===32||response.code===40?i=t.responseJSON.errors:c.each(response.errors,function(e,t){i+=e+" : "+t.message+"\n"}),f(this.$el.find("#alert-danger"),this.$el.find("#alert-success"),i)}})}),e.MessagesApp.Composer.View});