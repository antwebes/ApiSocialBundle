define(["app","text!apps/messages/composer/templates/compose.html","text!apps/messages/composer/templates/compose_form.html","text!apps/messages/composer/templates/message_successfull_sended.html","backbone-bootstrap","backbone-forms","backbone.autocomplete","entities/messages","handlebars"],function(e,t,n,r,i,s,o,u,a){function f(e){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}function l(e,t,n){$(t).hide(),$(e).html(""),$(e).removeClass("hide"),$(e).show(),$(e).html(n)}return e.module("MessagesApp.Composer.View",function(e,i,o,c,h,p){var d=null;e.ComposeView=c.ItemView.extend({tagName:"div",template:t,formTemplate:n,events:{"click #send":"submit","click #cancel-send":"back"},initialize:function(e){this.template=a.compile(this.template),this.model.on("error",this.onError,this),e.formTemplate&&(this.formTemplate=e.formTemplate)},onRender:function(){f(require.toUrl("backbone_autocomplete_css")),d=new s({model:this.model,template:a.compile(this.formTemplate)}),this.$el.find(".compose-wrapper").html(d.render().el);var e=new u.RecipientsCollection;return setTimeout(function(){(new AutoCompleteView({input:h("#form-field-recipient"),model:e})).render()},100),this},submit:function(){var e=d.commit({validate:!0});typeof e=="undefined"&&(l(this.$el.find("#alert-success"),this.$el.find("#alert-danger"),"Sending messsage..."),this.trigger("compose:submit",this.model))},back:function(e){return e.preventDefault(),e.stopPropagation(),this.trigger("compose:back"),!1},onError:function(e,t,n){var r=this,i="";t.responseJSON!==undefined?response=t.responseJSON:response=JSON.parse(t.responseText),response.code===32||response.code===40?i=r.trans(t.responseJSON.errors):h.each(response.errors,function(e,t){i+=r.trans(e)+" : "+r.trans(t.message)+"<br>"}),l(this.$el.find("#alert-danger"),this.$el.find("#alert-success"),i)},trans:function(e){var t={body:"messages::message",recipient:"messages::recipient","You cannot send a message to yourself":"messages::cannot_send_to_youself","The body is too short":"messages::message_too_short",subject:"messages::subject","The subject is too short":"messages::subject_too_short","You can't post more messages, limit exceced":"messages::limit_exceded","No recipient specified":"messages::no_recipient_specified"};return typeof t[e]!="undefined"&&(e=t[e]),i.request("trans",e)}}),e.MessageSuccessfulSended=c.ItemView.extend({template:a.compile(r)})}),e.MessagesApp.Composer.View});