define(["app","text!apps/messages/composer/templates/compose.html","text!apps/messages/composer/templates/compose_form.html","text!apps/messages/composer/templates/message_successfull_sended.html","backbone-bootstrap","backbone-forms","entities/messages","handlebars","text!backbone_autocomplete_css.css","backbone.autocomplete"],function(e,t,n,r,i,s,o,u,a){function l(e,t){if(typeof f[e]!="undefined")return;var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t)),n.appendChild(r),f[e]=!0}function c(e,t,n){$(t).hide(),$(e).html(""),$(e).removeClass("hide"),$(e).show(),$(e).html(n)}var f={};return e.module("MessagesApp.Composer.View",function(e,i,f,h,p,d){var v=null;e.ComposeView=h.ItemView.extend({tagName:"div",template:t,formTemplate:n,events:{"click #send":"submit","click #cancel-send":"back"},initialize:function(e){this.template=u.compile(this.template),this.model.on("error",this.onError,this),e.formTemplate&&(this.formTemplate=e.formTemplate)},onRender:function(){l("autocompleteCss",a),v=new s({model:this.model,template:u.compile(this.formTemplate)}),this.$el.find(".compose-wrapper").html(v.render().el);var e=new o.RecipientsCollection;return setTimeout(function(){(new AutoCompleteView({input:p("#form-field-recipient"),model:e})).render()},100),this},submit:function(){var e=v.commit({validate:!0});typeof e=="undefined"&&(c(this.$el.find("#alert-success"),this.$el.find("#alert-danger"),this.trans("messages::sending_message")+"..."),this.trigger("compose:submit",this.model))},back:function(e){return e.preventDefault(),e.stopPropagation(),this.trigger("compose:back"),!1},onError:function(e,t,n){var r=this,i="";t.responseJSON!==undefined?response=t.responseJSON:response=JSON.parse(t.responseText),response.code===32||response.code===40?i=r.trans(t.responseJSON.errors):p.each(response.errors,function(e,t){i+=r.trans(e)+" : "+r.trans(t.message)+"<br>"}),c(this.$el.find("#alert-danger"),this.$el.find("#alert-success"),i)},trans:function(e){var t={body:"messages::message",recipient:"messages::recipient","You cannot send a message to yourself":"messages::cannot_send_to_youself","The body is too short":"messages::message_too_short",subject:"messages::subject","The subject is too short":"messages::subject_too_short","You can't post more messages, limit exceced":"messages::limit_exceded","No recipient specified":"messages::no_recipient_specified"};return typeof t[e]!="undefined"&&(e=t[e]),i.request("trans",e)}}),e.MessageSuccessfulSended=h.ItemView.extend({template:u.compile(r)})}),e.MessagesApp.Composer.View});