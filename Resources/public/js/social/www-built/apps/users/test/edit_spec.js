define(["app","apps/users/test/fixtures","util/testutils","jasmine-fixture","apps/users/users_app","apps/dashboard/dashboard_app"],function(e,t){return describe("apps.users.edit",function(){beforeEach(function(){sinon.stub(jQuery,"ajax",function(e){if(e.url=="http://myserver/api/users/1/profiles"){var n={};e.success(n)}else if(e.url=="http://myserver/api/users/1"){var n=t.collection.get(1);e.success(n.toJSON())}else if(e.url=="http://myserver/api/me/change-password"){if(e.data){var r=JSON.parse(e.data);if(r.change_password&&r.change_password.current_password=="curr_false_pass"){var i={errors:{current_password:{message:"This value should be the user current password."}},code:"34"};e.error({responseJSON:i},JSON.stringify(i));return}}e.success("Password changed sucessfully")}else if(e.url=="http://myserver/api/me"&&e.type=="PUT"){if(e.data){var r=JSON.parse(e.data);if(r.change_password&&r.change_password.current_password=="curr_false_pass"){var i={errors:{current_password:{message:"This value should be the user current password."}},code:"34"};e.error({responseJSON:i},JSON.stringify(i));return}}e.success("")}})}),afterEach(function(){jQuery.ajax.restore()}),describe("Change password and email",function(){beforeEach(function(){e.trigger("user:changePassword")}),afterEach(function(){e.trigger("dashboard:show"),waitsForPresenceOfDOMElement("div.profile-info-name"),runs(function(){})}),describe("Change password",function(){it("should change password when all passwords are entered",function(){waitsForPresenceOfDOMElement("input[name=password_first]"),runs(function(){$("input[name=current_password]").first().val("currpass"),$("input[name=password_first]").val("newpass"),$("input[name=password_second]").val("newpass"),$("button.commit").first().trigger("click")}),waitsForPresenceOfDOMElement(".alert-success:contains('Data sent successfully')"),runs(function(){expect($("button.commit").first().parent().find(".alert-success").first().html()).toEqual("Data sent successfully")})}),it("should show all fields as required when no pass is entered",function(){waitsForPresenceOfDOMElement("input[name=password_first]"),runs(function(){$("button.commit").first().trigger("click")}),waitsForPresenceOfDOMElement("div.form-group.field-current_password.has-error > div > p:nth-child(2)"),runs(function(){expect($("button.commit").first().parent().find("div.form-group.field-current_password.has-error > div > p:nth-child(2)").html()).toEqual("Required"),expect($("button.commit").first().parent().find("div.form-group.field-password_first.has-error > div > p:nth-child(2)").html()).toEqual("Required"),expect($("button.commit").first().parent().find("div.form-group.field-password_second.has-error > div > p:nth-child(2)").html()).toEqual("Required")})}),it("should show the errors returned from the server",function(){waitsForPresenceOfDOMElement("input[name=password_first]"),runs(function(){$("input[name=current_password]").first().val("curr_false_pass"),$("input[name=password_first]").val("newpass"),$("input[name=password_second]").val("newpass"),$("button.commit").first().trigger("click")}),waitsForPresenceOfDOMElement(".alert-danger:contains('Current password : This value should be the user current password.')"),runs(function(){})})}),describe("Change email",function(){it("should change email",function(){waitsForPresenceOfDOMElement("input[name=password_first]"),runs(function(){$("input[name=current_password]:eq(1)").val("currpass"),$("input[name=email]").val("user@mail.com"),$("button.commit:eq(1)").trigger("click")}),waitsForPresenceOfDOMElement(".alert-success:contains('Data sent successfully')"),runs(function(){expect($("button.commit:eq(1)").parent().find(".alert-success").first().html()).toEqual("Data sent successfully")})}),it("should show all fields as required when all leaved blank",function(){waitsForPresenceOfDOMElement("input[name=password_first]"),runs(function(){$("button.commit:eq(1)").first().trigger("click")}),waitsForPresenceOfDOMElement("div.form-group.field-current_password.has-error > div > p:nth-child(2)"),runs(function(){expect($("button.commit:eq(1)").first().parent().find("div.form-group.field-current_password.has-error > div > p:nth-child(2)").html()).toEqual("Required"),expect($("button.commit:eq(1)").first().parent().find("div.form-group.field-email.has-error > div > p:nth-child(2)").html()).toEqual("Required")})})})})}),{name:"edit_spec"}});