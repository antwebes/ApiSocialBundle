define(["app","apps/users/index/index_controller","apps/users/test/fixtures","util/util","util/testutils","jasmine-fixture","apps/users/users_app","apps/chat/chat_app"],function(e,t,n,r){return describe("UsersApp.Controller.Index",function(){var r=function(e){var t=$.Deferred(),n=t.promise();return t.resolve(e),n},i=this;beforeEach(function(){var t=r(n.user1),s=r(new Backbone.Collection(n.collection.slice(0,18))),o=r(n.channels);i.appRequestStub=sinon.stub(e,"request",function(){if(arguments[0]=="user:entity"||arguments[0]=="user:entity:me")return t;if(arguments[0]=="user:realtime:entities")return s;if(arguments[0]=="channel:entities"&&arguments[1]=="?filter=&limit=4&offset=0&order=fans%3Ddesc")return o}),sinon.stub(jQuery,"ajax",function(e){if(e.url=="http://myserver/api/channels"&&e.data&&e.data.filter=="channelType=locale,isRoot=1"){var t={resources:n.channels.toJSON(),total:6,limit:6,offset:0,count:6,totalPages:1};e.success(t)}}),e.navigate("social-dinamic/app/SpecRunner.html")}),afterEach(function(){jQuery.ajax.restore(),i.appRequestStub.restore(),e.navigate("social-dinamic/app/SpecRunner.html")}),describe("Index",function(){var n;beforeEach(function(){n=sinon.stub(e,"trigger"),t.show(),sinon.stub(window,"uniqid",function(){return"myuniqid-gen"})}),afterEach(function(){n.restore(),uniqid.restore()}),it("should have a link to chat",function(){waitsForPresenceOfDOMElement("a:contains('Enter to chat')"),runs(function(){var t=sinon.stub(e,"navigate");$("#goChat").trigger("click"),waitsForSpyToBeCalled(n),runs(function(){expect(n).toHaveBeenCalledWith("chat:show",{nick:"user_1"})})})}),it("should show list of country chats",function(){ensureNumberOfElementsArePresent("#index_bottom .col-lg-6",10)}),it("should show list of users",function(){waitsForPresenceOfDOMElement("#index_medium .col-xs-4"),runs(function(){expect($("#index_medium .col-xs-4").length).toEqual(18)})})})}),{name:"index_controller_spec"}});