/*! Lazy Load 1.9.3 - MIT license - Copyright 2010-2013 Mika Tuupola */

/**
 * Copyright (c) 2011-2013 Felix Gnass
 * Licensed under the MIT license
 */

define("text!apps/users/list/templates/users_list_templates_layout.html",[],function(){return'<div class="col-sm-12" id="index_top">\n	<h1>List of users:</h1>\n</div>\n<hr/>\n<div class="col-sm-12" id="index_medium">\n</div>'}),define("text!apps/commons/list/templates/composite.html",[],function(){return"<script>\n<span>\n</span>\n</script>"}),define("text!apps/commons/list/templates/itemViewTemplate.html",[],function(){return'<script>\n	<a href="/users/<%= username_canonical %>-<%= id %>" data-rel="colorbox" class="cboxElement">\n		<img width=<%= sizeImage.width %> height=<%= sizeImage.height %> style="border: 2px solid #FFF; border-radius: 4px 4px 4px 4px; max-height:150px; max-width:180px;" <%=src_or_data()%>"<% if ((typeof(profile) != "undefined") && (typeof(profile.profile_photo) != "undefined")) { %>\n								<%= profile.profile_photo.path_small %>\n							<% } else { %>\n								<%= window.default_user_image_icon %>\n							<% } %>" title="<%= username %>">\n	</a>\n</script>'}),define("text!apps/commons/list/templates/empty.html",[],function(){return"<p>There are none.</p>"}),define("apps/commons/list/emptyView",["app","text!apps/commons/list/templates/empty.html","handlebars"],function(e,t,n){return e.module("Commons.List.Empty.View",function(e,r,i,s,o,u){e.EmptyView=s.View.extend({template:t,render:function(){var e=n.compile(t);this.$el.append(e())}})}),e.Commons.List.Empty.View}),define("text!apps/commons/list/templates/loading.html",[],function(){return'<script>\n<p><%= message %></p>\n<div id="spinner"></div>\n</script>'}),!function(e,t,n,r){var i=e(t);e.fn.lazyload=function(s){function o(){var t=0;f.each(function(){var n=e(this);if(!l.skip_invisible||n.is(":visible"))if(!e.abovethetop(this,l)&&!e.leftofbegin(this,l))if(e.belowthefold(this,l)||e.rightoffold(this,l)){if(++t>l.failure_limit)return!1}else n.trigger("appear"),t=0})}var u,f=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return s&&(r!==s.failurelimit&&(s.failure_limit=s.failurelimit,delete s.failurelimit),r!==s.effectspeed&&(s.effect_speed=s.effectspeed,delete s.effectspeed),e.extend(l,s)),u=l.container===r||l.container===t?i:e(l.container),0===l.event.indexOf("scroll")&&u.bind(l.event,function(){return o()}),this.each(function(){var t=this,n=e(t);t.loaded=!1,(n.attr("src")===r||n.attr("src")===!1)&&n.is("img")&&n.attr("src",l.placeholder),n.one("appear",function(){if(!this.loaded){if(l.appear){var r=f.length;l.appear.call(t,r,l)}e("<img />").bind("load",function(){var r=n.attr("data-"+l.data_attribute);n.hide(),n.is("img")?n.attr("src",r):n.css("background-image","url('"+r+"')"),n[l.effect](l.effect_speed),t.loaded=!0;var i=e.grep(f,function(e){return!e.loaded});if(f=e(i),l.load){var s=f.length;l.load.call(t,s,l)}}).attr("src",n.attr("data-"+l.data_attribute))}}),0!==l.event.indexOf("scroll")&&n.bind(l.event,function(){t.loaded||n.trigger("appear")})}),i.bind("resize",function(){o()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&i.bind("pageshow",function(t){t.originalEvent&&t.originalEvent.persisted&&f.each(function(){e(this).trigger("appear")})}),e(n).ready(function(){o()}),this},e.belowthefold=function(n,s){var o;return o=s.container===r||s.container===t?(t.innerHeight?t.innerHeight:i.height())+i.scrollTop():e(s.container).offset().top+e(s.container).height(),o<=e(n).offset().top-s.threshold},e.rightoffold=function(n,s){var o;return o=s.container===r||s.container===t?i.width()+i.scrollLeft():e(s.container).offset().left+e(s.container).width(),o<=e(n).offset().left-s.threshold},e.abovethetop=function(n,s){var o;return o=s.container===r||s.container===t?i.scrollTop():e(s.container).offset().top,o>=e(n).offset().top+s.threshold+e(n).height()},e.leftofbegin=function(n,s){var o;return o=s.container===r||s.container===t?i.scrollLeft():e(s.container).offset().left,o>=e(n).offset().left+s.threshold+e(n).width()},e.inviewport=function(t,n){return!(e.rightoffold(t,n)||e.leftofbegin(t,n)||e.belowthefold(t,n)||e.abovethetop(t,n))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window,document),define("jquery-lazyload",["jquery"],function(){}),define("util/lazyloaderhelper",["jquery-lazyload"],function(){var e=function(e){var t=!1;e.on("show",function(){e.$el.find("img.lazy").lazyload({effect:"fadeIn"}),e.on("after:item:added",function(e){e.$el.find("img.lazy").lazyload({effect:"fadeIn"}),e.on("show",function(){e.$el.find("img.lazy").lazyload({effect:"fadeIn"}),t=!0})})})};return e}),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("spin",t):e.Spinner=t()}(this,function(){function r(e,t){var n=document.createElement(e||"div"),r;for(r in t)n[r]=t[r];return n}function i(e){for(var t=1,n=arguments.length;t<n;t++)e.appendChild(arguments[t]);return e}function o(e,r,i,o){var u=["opacity",r,~~(e*100),i,o].join("-"),a=.01+i/o*100,f=Math.max(1-(1-e)/r*(100-a),e),l=n.substring(0,n.indexOf("Animation")).toLowerCase(),c=l&&"-"+l+"-"||"";return t[u]||(s.insertRule("@"+c+"keyframes "+u+"{"+"0%{opacity:"+f+"}"+a+"%{opacity:"+e+"}"+(a+.01)+"%{opacity:1}"+(a+r)%100+"%{opacity:"+e+"}"+"100%{opacity:"+f+"}"+"}",s.cssRules.length),t[u]=1),u}function u(t,n){var r=t.style,i,s;if(r[n]!==undefined)return n;n=n.charAt(0).toUpperCase()+n.slice(1);for(s=0;s<e.length;s++){i=e[s]+n;if(r[i]!==undefined)return i}}function a(e,t){for(var n in t)e.style[u(e,n)||n]=t[n];return e}function f(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]===undefined&&(e[r]=n[r])}return e}function l(e){var t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function h(e){if(typeof this=="undefined")return new h(e);this.opts=f(e||{},h.defaults,c)}function p(){function e(e,t){return r("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}s.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(t,n){function o(){return a(e("group",{coordsize:s+" "+s,coordorigin:-r+" "+ -r}),{width:s,height:s})}function c(t,s,u){i(f,i(a(o(),{rotation:360/n.lines*t+"deg",left:~~s}),i(a(e("roundrect",{arcsize:n.corners}),{width:r,height:n.width,left:n.radius,top:-n.width>>1,filter:u}),e("fill",{color:n.color,opacity:n.opacity}),e("stroke",{opacity:0}))))}var r=n.length+n.width,s=2*r,u=-(n.width+n.length)*2+"px",f=a(o(),{position:"absolute",top:u,left:u}),l;if(n.shadow)for(l=1;l<=n.lines;l++)c(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=n.lines;l++)c(l);return i(t,f)},h.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}}var e=["webkit","Moz","ms","O"],t={},n,s=function(){var e=r("style",{type:"text/css"});return i(document.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),c={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};h.defaults={},f(h.prototype,{spin:function(e){this.stop();var t=this,i=t.opts,s=t.el=a(r(0,{className:i.className}),{position:i.position,width:0,zIndex:i.zIndex}),o=i.radius+i.length+i.width,u,f;e&&(e.insertBefore(s,e.firstChild||null),f=l(e),u=l(s),a(s,{left:(i.left=="auto"?f.x-u.x+(e.offsetWidth>>1):parseInt(i.left,10)+o)+"px",top:(i.top=="auto"?f.y-u.y+(e.offsetHeight>>1):parseInt(i.top,10)+o)+"px"})),s.setAttribute("role","progressbar"),t.lines(s,t.opts);if(!n){var c=0,h=(i.lines-1)*(1-i.direction)/2,p,d=i.fps,v=d/i.speed,m=(1-i.opacity)/(v*i.trail/100),g=v/i.lines;(function y(){c++;for(var e=0;e<i.lines;e++)p=Math.max(1-(c+(i.lines-e)*g)%v*m,i.opacity),t.opacity(s,e*i.direction+h,p,i);t.timeout=t.el&&setTimeout(y,~~(1e3/d))})()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=undefined),this},lines:function(e,t){function l(e,n){return a(r(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*s+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.corners*t.width>>1)+"px"})}var s=0,u=(t.lines-1)*(1-t.direction)/2,f;for(;s<t.lines;s++)f=a(r(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:n&&o(t.opacity,t.trail,u+s*t.direction,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&i(f,a(l("#000","0 0 4px #000"),{top:"2px"})),i(e,i(f,l(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}});var d=a(r("group"),{behavior:"url(#default#VML)"});return!u(d,"transform")&&d.adj?p():n=u(d,"animation"),h}),function(e){if(typeof exports=="object")e(require("jquery"),require("spin"));else if(typeof define=="function"&&define.amd)define("spin.jquery",["jquery","spin"],e);else{if(!window.Spinner)throw new Error("Spin.js not present");e(window.jQuery,window.Spinner)}}(function(e,t){e.fn.spin=function(n,r){return this.each(function(){var i=e(this),s=i.data();s.spinner&&(s.spinner.stop(),delete s.spinner),n!==!1&&(n=e.extend({color:r||i.css("color")},e.fn.spin.presets[n]||n),s.spinner=(new t(n)).spin(this))})},e.fn.spin.presets={tiny:{lines:8,length:2,width:2,radius:3},small:{lines:8,length:4,width:3,radius:5},large:{lines:10,length:8,width:4,radius:8}}}),define("apps/commons/list/listView",["app","text!apps/commons/list/templates/composite.html","text!apps/commons/list/templates/itemViewTemplate.html","apps/commons/list/emptyView","text!apps/commons/list/templates/loading.html","util/lazyloaderhelper","spin.jquery"],function(e,t,n,r,i,s){return e.module("Commons.List",function(e,o,u,a,f,l){var c=a.ItemView.extend({tagName:'li class="col-xs-3"',template:n,initialize:function(e){this.tagName=this.options.tagName,this.delegateEventsToParentView(),e.lazy&&s(this)},templateHelpers:function(){var e=this;return{src_or_data:function(){return e.options.lazy?'class="lazy" data-original=':"src="}}},serializeData:function(){var e=function(t){var n={};return l.each(t.attributes,function(t,r){l.isFunction(t.toJSON)?n[r]=e(t):n[r]=t}),n},t=e(this.model);return l.extend(t,{sizeImage:this.options.sizeImage}),t},delegateEventsToParentView:function(){var e=/^(\S+)\s*(.*)$/;if(this.options.toParentEvents){var t=this.options.toParentEvents;for(var n in t){var r=t[n],i=n.match(e),s=i[1],o=i[2];this.delegateEventToParentView(s,o,r)}}},delegateEventToParentView:function(e,t,n){var r=this.options.parentView,i=l.bind(r[n],r,this);t===""?this.$el.on(e,i):this.$el.on(e,t,i)}});e.CompositeView=u.Marionette.CompositeView.extend({tagName:'ul class="row list-unstyled"',itemView:c,emptyView:r.EmptyView,template:t,itemViewOptions:function(e,t){var n={template:this.options.templateItemView};return this.options.tagNameItemView&&l.extend(n,{tagName:this.options.tagNameItemView}),this.options.sizeImage&&(f.isPlainObject(this.options.sizeImage)?l.extend(n,{sizeImage:this.options.sizeImage}):l.extend(n,{sizeImage:{width:this.options.sizeImage,height:this.options.sizeImage}})),this.subviewEvents&&l.extend(n,{toParentEvents:this.subviewEvents,parentView:this}),this.options.lazy&&l.extend(n,{lazy:!0}),this.options.perserveOriginalTemplate&&l.extend(n,{perserveOriginalTemplate:!0}),n}}),e.Loading=a.ItemView.extend({template:i,initialize:function(e){var t=e||{};this.title=t.title||"Loading Data",this.message=t.message||"Please wait, data is loading."},serializeData:function(){return{title:this.title,message:this.message}},onShow:function(){var e={lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"30px",left:"auto"};f("#spinner").spin(e)}})}),e.Commons.List}),define("apps/users/list/list_view",["app","text!apps/users/list/templates/users_list_templates_layout.html","apps/commons/list/listView","util/lazyloaderhelper"],function(e,t,n,r){return e.module("UsersApp.List.View",function(e,i,s,o,u,a){e.Layout=o.Layout.extend({template:Handlebars.compile(t),regions:{index_top_Region:"#index_top",index_medium_Region:"#index_medium",index_bottom_Region:"#index_bottom"}}),e.UsersView=n.CompositeView.extend({subviewEvents:{"click #chat-with-user":"_chatWithUser","click .cboxElement":"_userDetails"},_chatWithUser:function(e){var t=i.request("user:entity",window.user_id);u.when(t).done(function(t){var n={nick:t.get("username"),"private":e.model.get("username")};i.trigger("chat:show",n)})},_userDetails:function(e){var t=e.model;i.trigger("users:show",t.get("username_canonical"),t.get("id"))},initialize:function(){r(this)}})}),e.UsersApp.List.View}),define("text!apps/users/list/templates/item_template.html",[],function(){return'<script>\n	<a data-rel="colorbox" class="cboxElement user-detail-link">\n		<img class="img-responsive lazy" width=<%= sizeImage.width %> height=<%= sizeImage.height %> style="border: 1px solid #DDDDDD; border-radius: 4px 4px 4px 4px;" data-original=<% if ((typeof(profile) != "undefined") && (typeof(profile.profile_photo) != "undefined")) { %>\n								"<%= profile.profile_photo.path_large %>"\n							<% } else { %>\n								"<%= window.default_user_image_large %>"\n							<% } %> title="<%= username %>">\n		<div class="tags hidden-xs">\n	        <span class="label-holder">\n	            <span class="label label-info arrowed"><strong><i class="fa fa-user"></i> <%= username %></strong></span>\n	        </span>\n			\n	        <span class="label-holder">\n	        	<% if (typeof(city)!= "undefined") { %>\n	        		<% if (city.name === \'no_city\') { %>\n	            		<span class="label label-danger"><i class="fa fa-map-marker"></i> <%= city.country.name %></span>\n	            	<% } else { %>\n	            		<span class="label label-danger"><i class="fa fa-map-marker"></i> <%= city.name %></span>\n	            	<% } %>\n	            <% } %>\n	        </span>\n	        \n	    </div>\n	</a>\n	<div class="tools tools-top">\n		<a id="chat-with-user">\n			<i class=" fa fa-comment"></i> Chat\n		</a>\n	</div>\n</script>'}),define("apps/users/list/list_controller",["app","apps/users/list/list_view","apps/commons/pagination/paginate","apps/commons/list/listView","text!apps/users/list/templates/item_template.html"],function(e,t,n,r,i){return e.module("UsersApp.List",function(e,s,o,u,a,f){e.Controller={listUsers:function(i){i?i=parseInt(i):i=1;var o=new t.Layout,u=n.Collection.extend({url:window.api_endpoint+"/api/users",state:{firstPage:1,currentPage:i,pageSize:30,pagesInRange:4}}),a=new u,f=new r.Loading({message:"Reading Users."}),l=new n.Layout;o.on("show",function(){l.on("render",function(){l.pages_region.show(f)}),l.on("show",function(){e.Controller._fetchUserCollection(a,l,i)}),o.index_medium_Region.show(l)}),s.container_center_Region.show(o)},_fetchUserCollection:function(e,r,o){e.fetch({reset:!0,success:function(u){e.getPage(o);var a=new n.PaginationView({collection:e});a.on("goToPage",function(e){s.navigate("users/"+e)}),a.on("gotoNext",function(e){s.navigate("users/"+e)}),a.on("goToPrev",function(e){s.navigate("users/"+e)}),r.pages_region.show(a),r.list_region.show(new t.UsersView({collection:e,templateItemView:i,tagName:'ul class="ace-thumbnails"',tagNameItemView:'li class="col-xs-4 col-lg-2"',sizeImage:"200px"}))},error:function(e,t,n){requirejs(["apps/commons/errors/generic"],function(e){s.container_center_Region.show(new e.GenericErrorView({model:t}))})},silent:!0})}}}),e.UsersApp.List.Controller});