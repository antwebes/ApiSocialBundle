define(["app","text!apps/channels/form/templates/form_layout_Template.html","text!apps/users/form/templates/form_layout_Template.html","text!apps/users/form/templates/form_layout_change_password_Template.html","backbone-forms"],function(e,t,n,r,i){return e.module("UsersApp.Form",function(e,s,o,u,a,f){function l(e,t,n){a(t).hide(),a(e).html(""),a(e).removeClass("hide"),a(e).show(),a(e).html(n)}e.Layout=u.Layout.extend({template:t,regions:{form_Region:".form_show",alert_danger_Region:".alert-danger",alert_success_Region:".alert-success"},events:{"click .commit":"formCommit","click .delete":"deleteClick"},initialize:function(e){this.type=e.type,this.model.on("sync",this.onSync,this),this.model.on("error",this.onError,this),this.model.on("destroy",this.onDestroy,this)},onSync:function(e,t,n){},onError:function(e,t,n){var r=this,i="";t.responseJSON!==undefined?response=t.responseJSON:response=JSON.parse(t.responseText),response.code===32?i=t.responseJSON.errors:a.each(response.errors,function(e,t){i+=e+" : "+t.message+"<br>"}),l(this.$el.find(this.regions.alert_danger_Region),this.$el.find(this.regions.alert_success_Region),i)},onDestroy:function(e,t,n){o.history.navigate("me/dashboard",!0)},onShow:function(){},onClose:function(){this.model.off()},onRender:function(){a(this.alert_success_Region.el).hide(),a(this.alert_danger_Region.el).hide(),this.form_Region.show(new e.FormView({model:this.model,type:this.type,layout:this}))},formCommit:function(){var e=this;a(this.alert_success_Region.el).hide(),a(this.alert_danger_Region.el).hide();var t=this.form,n=t.commit({validate:!0}),r=t.getValue();if(typeof n=="undefined"){var i={success:function(t){l(e.$el.find(e.regions.alert_success_Region),e.$el.find(e.regions.alert_danger_Region),"Data sent successfully")}};this.model.save({},i),s.User.set("profile",this.model)}},deleteClick:function(){var e=this;require(["apps/commons/dialog/dialog_view"],function(t){t.confirm("Are you sure you want to delete your profile? This unlink the photo profile with you","Delete moderator").then(function(t){t&&(s.User.unset("profile"),e.model.destroy())})})}}),e.LayoutUser=e.Layout.extend({template:n}),e.LayoutUserChangePassword=e.Layout.extend({template:r,onError:function(e,t,n){var r=this,i="",s={current_password:"Current password",first:"New password",second:"Repeat password"},o=function(e){a.each(e,function(e,t){e=="plainPassword"?o(t):i+=(s[e]||e)+" : "+t.message+"<br>"})};t.responseJSON!==undefined?response=t.responseJSON:response=JSON.parse(t.responseText),response.code===32?i=t.responseJSON.errors:o(t.responseJSON.errors),l(this.$el.find(this.regions.alert_danger_Region),this.$el.find(this.regions.alert_success_Region),i)}}),e.LayoutUserChangeEmail=e.Layout.extend({template:r,onError:function(e,t,n){var r=this,i="",s={current_password:"Password",email:"Email"},o=function(e){a.each(e,function(e,t){e=="plainPassword"?o(t):i+=(s[e]||e)+" : "+t.message+"<br>"})};t.responseJSON!==undefined?response=t.responseJSON:response=JSON.parse(t.responseText),response.code===32?i=t.responseJSON.errors:o(t.responseJSON.errors),l(this.$el.find(this.regions.alert_danger_Region),this.$el.find(this.regions.alert_success_Region),i)}}),e.FormView=u.View.extend({type:null,initialize:function(e){this.type=e.type},onSync:function(e,t,n){this.options.layout.$el.find(".alert-success").html("Data sent successfully")},onError:function(e,t,n){t.responseJSON!==undefined?response=t.responseJSON:response=JSON.parse(t.responseText),response.code===32?this.options.layout.$el.find(".alert-danger").html(t.responseJSON.errors):a.each(response.errors,function(e,t){this.options.layout.$el.find(".alert-danger").append(e+" : "+t.message)})},onDestroy:function(e,t,n){a(".alert").html(t)},render:function(){var e=new i({model:this.model});return a(this.el).html(""),a(this.el).html(e.render().el),this.options.layout.form=e,this}})}),e.UsersApp.Form});