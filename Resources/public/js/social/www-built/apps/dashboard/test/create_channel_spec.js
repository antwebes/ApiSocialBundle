define(["app","apps/dashboard/show/show_controller","apps/users/test/fixtures","apps/dashboard/test/fixtures","entities/channel","entities/user","util/testutils"],function(e,t,n,r,i,s){describe("Test dashboard",function(){var s=this,o=function(e){var t=$.Deferred(),n=t.promise();return t.resolve(e),n};beforeEach(function(){e.User=new Backbone.Model({username:"user_1",username_canonical:"user_1",channels_fan:new Backbone.Collection([]),channels:new Backbone.Collection([])});var u=o(n.user_object1);s.sendErrorFromAPI=!1,this.stub=sinon.stub(e,"request"),this.stub.withArgs("user:entity:me",1).returns(u),this.stub.withArgs("channel:entity:new").returns(new i.Channel),sinon.stub(jQuery,"ajax",function(e){if(e.url==window.api_endpoint+"/api/channelstype"&&e.type=="GET")e.success({});else if(e.url==window.api_endpoint+"/api/channelstype")e.success(r.channelstype);else if(e.url==window.api_endpoint+"/api/channel/modes")e.success(r.channelmodes);else if(e.url==window.api_endpoint+"/api/channels"&&e.type=="POST"){if(s.sendErrorFromAPI){e.error({});return}e.success(r.channelcreated)}}),t.createChannel()}),afterEach(function(){this.stub.restore(),jQuery.ajax.restore(),s.sendErrorFromAPI=!1}),it("When I execute from dashboardController method createChannel I see the profile picture and form",function(){ensureNumberOfElementsArePresent(".profile-picture",1),ensureNumberOfElementsArePresent("#form_show",1)}),it("Should show error when the api return an error",function(){s.sendErrorFromAPI=!0,waitsForPresenceOfDOMElement("#form_show"),runs(function(){$("input[name=name]").val("nombre"),$("input[name=irc_channel]").val("#nombre"),$("textarea").val("decripcion"),$("#commit").trigger("click"),ensureNumberOfElementsArePresent('#alert-danger:contains("An error has ocurred. Please try it later")',1)})}),it("Should send a channel creation request to the api and redirect when the form is filled correctly",function(){waitsForPresenceOfDOMElement("#form_show"),runs(function(){$("input[name=name]").val("nombre"),$("input[name=irc_channel]").val("#nombre"),$("textarea").val("decripcion"),$("#commit").trigger("click"),ensureNumberOfElementsArePresent('#alert-success:contains("Data sent successfully")',1)})})})});