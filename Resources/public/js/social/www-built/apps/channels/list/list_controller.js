/*! Lazy Load 1.9.3 - MIT license - Copyright 2010-2013 Mika Tuupola */

/*
  backbone.paginator 2.0.0
  http://github.com/backbone-paginator/backbone.paginator

  Copyright (c) 2013 Jimmy Yuen Ho Wong and contributors
  Licensed under the MIT @license.
*/

/**
 * Copyright (c) 2011-2013 Felix Gnass
 * Licensed under the MIT license
 */

define("text!apps/channels/list/templates/list_layout_template.html",[],function(){return'<div class="col-sm-12" id="index_top">\n	<h1>List of irc channels:</h1>\n</div>\n<hr/>\n<div class="col-sm-12" id="index_medium">\n</div>\n\n<a href="/rooms/categories" title="List all categories"><h2>List all categories</h2></a>'}),define("text!apps/channels/list/templates/users_channels_list_layout_template.html",[],function(){return'<div class="col-sm-12" id="index_top">\n	<h1>{{ title }}</h1>\n</div>\n<hr/>\n<div class="col-sm-12" id="index_medium">\n</div>'}),define("text!apps/channels/list/templates/item_template.html",[],function(){return'<script>\n	<div class="col-xs-3">\n		<a href="/<%= slug %>" data-rel="colorbox" class="cboxElement">\n			<% if (typeof(photo) != "undefined") { %>\n				<img height="100%" width="100%" class="pull-left lazy" data-original=<%=photo.path %> alt="<%= 	name %>">\n			<% } else { %>\n				<img height="100%" width="100%" class="pull-left lazy" data-original="<%= window.default_chat_image %>" alt="<%= 	name %>">\n			<% } %>\n		</a>\n	</div>\n	<div class="col-xs-9 box-basic">\n		<h3>\n			<a href="/<%= slug %>" data-rel="colorbox" class="cboxElement">\n				Room <%= name %>\n			</a>\n		</h3>\n		<p class="hidden-xs" style="border-bottom:1px solid;">Chat room of <%=name%>, enter to chat for free</p>\n		<div class="row">\n			<div class="col-xs-4 border-right">\n				<a href="/users/<%=owner.username_canonical%>-<%=owner.id%>">\n				<img width="34" height="34" class="pull-left frame-profile lazy" data-original=\n				<% if ((typeof(owner.profile) != "undefined") && (typeof(owner.profile.profile_photo) != "undefined")) { %>\n					"<%= owner.profile.profile_photo.path_icon %>"\n				<% } else { %>\n					"<%= window.default_user_image_icon %>"\n				<% } %>\n				>\n				<%=owner.username%></a>\n				<p class="type-off">Founder</p>\n			</div>\n			<div class="col-xs-4 border-right">\n				<i class="fa fa-user"></i> <%= count_visits %>\n				<p class="type-off">Visitors</p>\n			</div>	\n			<div class="col-xs-4">\n				<i class="fa fa-bullhorn"></i><a class="channel-type"><b> <%= channel_type.name %></b></a>\n				<p class="type-off">Channel Type</p>\n			</div>				\n		</div>\n	</div>\n</script>'}),define("text!apps/channels/list/templates/popular_item_template.html",[],function(){return'<script>\n	<div class="col-xs-3">\n		<a href="/<%= slug %>" data-rel="colorbox" class="cboxElement">\n			<% if (typeof(photo) != "undefined") { %>\n				<img height="100%" width="100%" class="pull-left lazy" data-original=<%=photo.path %> alt="<%= 	name %>">\n			<% } else { %>\n				<img height="100%" width="100%" class="pull-left lazy" data-original="<%= window.default_chat_image %>" alt="<%= 	name %>">\n			<% } %>\n		</a>\n	</div>\n	<div class="col-xs-9">\n		<h3>\n			<a href="/<%= slug %>" data-rel="colorbox" class="cboxElement">\n				Room <%= name %>\n			</a>\n		</h3>\n		<p class="hidden-xs">Chat room of <%=name%>, enter to chat for free</p>\n		<p class="type-off">Created by <a href="/users/<%=owner.username_canonical%>-<%=owner.id%>"><%=owner.username%></a></p>\n\n		<div style="margin-bottom:15px;" class="col-lg-6 col-xs-12 clearfix">\n			<%\n			var children = channels.slice(0,4);\n			for(var i=0;i<children.length;i++){\n			%>\n			<span class="type-off">\n				<a title="Enter the chat of <%= children[i].name %>" href="/<%= children[i].slug %>"> &nbsp; <%= children[i].name %></a>\n			</span>\n			<% } %>\n			<a title="Enter the chat of <%= name %>" href="/<%= slug %>">more...</a>\n        </div>\n	</div>\n</script>'}),!function(e,t,n,r){var i=e(t);e.fn.lazyload=function(s){function o(){var t=0;f.each(function(){var n=e(this);if(!l.skip_invisible||n.is(":visible"))if(!e.abovethetop(this,l)&&!e.leftofbegin(this,l))if(e.belowthefold(this,l)||e.rightoffold(this,l)){if(++t>l.failure_limit)return!1}else n.trigger("appear"),t=0})}var u,f=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return s&&(r!==s.failurelimit&&(s.failure_limit=s.failurelimit,delete s.failurelimit),r!==s.effectspeed&&(s.effect_speed=s.effectspeed,delete s.effectspeed),e.extend(l,s)),u=l.container===r||l.container===t?i:e(l.container),0===l.event.indexOf("scroll")&&u.bind(l.event,function(){return o()}),this.each(function(){var t=this,n=e(t);t.loaded=!1,(n.attr("src")===r||n.attr("src")===!1)&&n.is("img")&&n.attr("src",l.placeholder),n.one("appear",function(){if(!this.loaded){if(l.appear){var r=f.length;l.appear.call(t,r,l)}e("<img />").bind("load",function(){var r=n.attr("data-"+l.data_attribute);n.hide(),n.is("img")?n.attr("src",r):n.css("background-image","url('"+r+"')"),n[l.effect](l.effect_speed),t.loaded=!0;var i=e.grep(f,function(e){return!e.loaded});if(f=e(i),l.load){var s=f.length;l.load.call(t,s,l)}}).attr("src",n.attr("data-"+l.data_attribute))}}),0!==l.event.indexOf("scroll")&&n.bind(l.event,function(){t.loaded||n.trigger("appear")})}),i.bind("resize",function(){o()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&i.bind("pageshow",function(t){t.originalEvent&&t.originalEvent.persisted&&f.each(function(){e(this).trigger("appear")})}),e(n).ready(function(){o()}),this},e.belowthefold=function(n,s){var o;return o=s.container===r||s.container===t?(t.innerHeight?t.innerHeight:i.height())+i.scrollTop():e(s.container).offset().top+e(s.container).height(),o<=e(n).offset().top-s.threshold},e.rightoffold=function(n,s){var o;return o=s.container===r||s.container===t?i.width()+i.scrollLeft():e(s.container).offset().left+e(s.container).width(),o<=e(n).offset().left-s.threshold},e.abovethetop=function(n,s){var o;return o=s.container===r||s.container===t?i.scrollTop():e(s.container).offset().top,o>=e(n).offset().top+s.threshold+e(n).height()},e.leftofbegin=function(n,s){var o;return o=s.container===r||s.container===t?i.scrollLeft():e(s.container).offset().left,o>=e(n).offset().left+s.threshold+e(n).width()},e.inviewport=function(t,n){return!(e.rightoffold(t,n)||e.leftofbegin(t,n)||e.belowthefold(t,n)||e.abovethetop(t,n))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window,document),define("jquery-lazyload",["jquery"],function(){}),define("util/lazyloaderhelper",["jquery-lazyload"],function(){var e=function(e){var t=!1;e.on("show",function(){e.$el.find("img.lazy").lazyload({effect:"fadeIn"}),e.on("after:item:added",function(e){e.$el.find("img.lazy").lazyload({effect:"fadeIn"}),e.on("show",function(){e.$el.find("img.lazy").lazyload({effect:"fadeIn"}),t=!0})})})};return e}),define("text!apps/commons/list/templates/empty.html",[],function(){return"<p>There are none.</p>"}),define("apps/commons/list/emptyView",["app","text!apps/commons/list/templates/empty.html","handlebars"],function(e,t,n){return e.module("Commons.List.Empty.View",function(e,r,i,s,o,u){e.EmptyView=s.View.extend({template:t,render:function(){var e=n.compile(t);this.$el.append(e())}})}),e.Commons.List.Empty.View}),define("apps/channels/list/list_view",["app","text!apps/channels/list/templates/list_layout_template.html","text!apps/channels/list/templates/users_channels_list_layout_template.html","text!apps/channels/list/templates/item_template.html","text!apps/channels/list/templates/popular_item_template.html","handlebars","util/lazyloaderhelper","apps/commons/list/emptyView"],function(e,t,n,r,i,s,o,u){return e.module("ChannelsApp.List.View",function(e,a,f,l,c,h){e.Layout=l.Layout.extend({template:s.compile(t),regions:{index_top_Region:"#index_top",index_medium_Region:"#index_medium",index_bottom_Region:"#index_bottom"}}),e.UsersChannelsLayout=l.Layout.extend({template:s.compile(n),regions:{index_top_Region:"#index_top",index_medium_Region:"#index_medium",index_bottom_Region:"#index_bottom"},serializeData:function(){return{title:this.options.title}}}),e.ItemView=l.ItemView.extend({tagName:'div style="margin-bottom:25px;"',className:"col-lg-6 col-xs-12 clearfix",template:r,events:{"click .channel-type":"clickedChannelType"},clickedChannelType:function(){var e="filter=channelType="+this.model.get("channel_type").name;a.trigger("channels:filter",e)}}),e.PopularItemView=e.ItemView.extend({template:i}),e.ItemsListView=f.Marionette.CompositeView.extend({itemViewContainer:"#channel_list",emptyView:u.EmptyView,itemView:e.ItemView,initialize:function(){o(this),this.clearFixes=[]},appendHtml:function(e,t,n){if(n!==0&&n%2===0){var r=this.createClearfixDiv();this.clearFixes.push(r),e.$el.find(this.itemViewContainer).append(r.el)}e.$el.find(this.itemViewContainer).append(t.el)},checkEmpty:function(){this.isEmpty(this.collection)&&(h.each(this.clearFixes,function(e){e.remove()}),this.clearFixes=[],this.showEmptyView())},itemViewOptions:function(e,t){var n={template:this.options.templateItemView};return this.options.tagNameItemView&&h.extend(n,{tagName:this.options.tagNameItemView}),this.options.sizeImage&&(c.isPlainObject(this.options.sizeImage)?h.extend(n,{sizeImage:this.options.sizeImage}):h.extend(n,{sizeImage:{width:this.options.sizeImage,height:this.options.sizeImage}})),n},createClearfixDiv:function(){var e=new f.Marionette.ItemView({template:s.compile("")});return e.render().$el.addClass("clearfix"),e}})}),e.ChannelsApp.List.View}),!function(e){if("object"==typeof exports)module.exports=e(require("underscore"),require("backbone"));else if("function"==typeof define&&define.amd)define("paginator",["underscore","backbone"],e);else if("undefined"!=typeof _&&"undefined"!=typeof Backbone){var t=Backbone.PageableCollection,n=e(_,Backbone);Backbone.PageableCollection.noConflict=function(){return Backbone.PageableCollection=t,n}}}(function(e,t){function n(t,n){if(!e.isNumber(t)||e.isNaN(t)||!e.isFinite(t)||~~t!==t)throw new TypeError("`"+n+"` must be a finite integer");return t}function r(e){for(var t,n,r,i,s={},o=decodeURIComponent,u=e.split("&"),a=0,f=u.length;f>a;a++){var l=u[a];t=l.split("="),n=t[0],r=t[1]||!0,n=o(n),r=o(r),i=s[n],d(i)?i.push(r):s[n]=i?[i,r]:r}return s}function i(e,t,n){var r=e._events[t];if(r&&r.length){var i=r[r.length-1],s=i.callback;i.callback=function(){try{s.apply(this,arguments),n()}catch(e){throw e}finally{i.callback=s}}}else n()}var s=e.extend,o=e.omit,u=e.clone,a=e.each,f=e.pick,l=e.contains,c=e.isEmpty,h=e.pairs,p=e.invert,d=e.isArray,v=e.isFunction,m=e.isObject,g=e.keys,y=e.isUndefined,b=Math.ceil,w=Math.floor,E=Math.max,S=t.Collection.prototype,x=/[\s'"]/g,T=/[<>\s'"]/g,N=t.PageableCollection=t.Collection.extend({state:{firstPage:1,lastPage:null,currentPage:null,pageSize:25,totalPages:null,totalRecords:null,sortKey:null,order:-1},mode:"server",queryParams:{currentPage:"page",pageSize:"per_page",totalPages:"total_pages",totalRecords:"total_entries",sortKey:"sort_by",order:"order",directions:{"-1":"asc",1:"desc"}},constructor:function(e,t){S.constructor.apply(this,arguments),t=t||{};var n=this.mode=t.mode||this.mode||C.mode,r=s({},C.queryParams,this.queryParams,t.queryParams||{});r.directions=s({},C.queryParams.directions,this.queryParams.directions,r.directions||{}),this.queryParams=r;var i=this.state=s({},C.state,this.state,t.state||{});i.currentPage=null==i.currentPage?i.firstPage:i.currentPage,d(e)||(e=e?[e]:[]),e=e.slice(),"server"==n||null!=i.totalRecords||c(e)||(i.totalRecords=e.length),this.switchMode(n,s({fetch:!1,resetState:!1,models:e},t));var o=t.comparator;if(i.sortKey&&!o&&this.setSorting(i.sortKey,i.order,t),"server"!=n){var a=this.fullCollection;o&&t.full&&(this.comparator=null,a.comparator=o),t.full&&a.sort(),e&&!c(e)&&(this.reset(e,s({silent:!0},t)),this.getPage(i.currentPage),e.splice.apply(e,[0,e.length].concat(this.models)))}this._initState=u(this.state)},_makeFullCollection:function(e,n){var r,i,s,o=["url","model","sync","comparator"],u=this.constructor.prototype,a={};for(r=0,i=o.length;i>r;r++)s=o[r],y(u[s])||(a[s]=u[s]);var f=new(t.Collection.extend(a))(e,n);for(r=0,i=o.length;i>r;r++)s=o[r],this[s]!==u[s]&&(f[s]=this[s]);return f},_makeCollectionEventHandler:function(e,t){return function(n,r,o,f){var l=e._handlers;a(g(l),function(n){var r=l[n];e.off(n,r),t.off(n,r)});var c=u(e.state),h=c.firstPage,p=0===h?c.currentPage:c.currentPage-1,d=c.pageSize,v=p*d,m=v+d;if("add"==n){var w,E,S,x,f=f||{};if(o==t)E=t.indexOf(r),E>=v&&m>E&&(x=e,w=S=E-v);else{w=e.indexOf(r),E=v+w,x=t;var S=y(f.at)?E:f.at+v}if(f.onRemove||(++c.totalRecords,delete f.onRemove),e.state=e._checkState(c),x){x.add(r,s({},f||{},{at:S}));var T=w>=d?r:!y(f.at)&&m>S&&e.length>d?e.at(d):null;T&&i(o,n,function(){e.remove(T,{onAdd:!0})})}}if("remove"==n)if(f.onAdd)delete f.onAdd;else{if(--c.totalRecords){var N=c.totalPages=b(c.totalRecords/d);c.lastPage=0===h?N-1:N||h,c.currentPage>N&&(c.currentPage=c.lastPage)}else c.totalRecords=null,c.totalPages=null;e.state=e._checkState(c);var C,k=f.index;o==e?((C=t.at(m))?i(e,n,function(){e.push(C,{onRemove:!0})}):!e.length&&c.totalRecords&&e.reset(t.models.slice(v-d,m-d),s({},f,{parse:!1})),t.remove(r)):k>=v&&m>k&&((C=t.at(m-1))&&i(e,n,function(){e.push(C,{onRemove:!0})}),e.remove(r),!e.length&&c.totalRecords&&e.reset(t.models.slice(v-d,m-d),s({},f,{parse:!1})))}if("reset"==n)if(f=o,o=r,o==e&&null==f.from&&null==f.to){var L=t.models.slice(0,v),A=t.models.slice(v+e.models.length);t.reset(L.concat(e.models).concat(A),f)}else o==t&&((c.totalRecords=t.models.length)||(c.totalRecords=null,c.totalPages=null),"client"==e.mode&&(c.lastPage=c.currentPage=c.firstPage),e.state=e._checkState(c),e.reset(t.models.slice(v,m),s({},f,{parse:!1})));"sort"==n&&(f=o,o=r,o===t&&e.reset(t.models.slice(v,m),s({},f,{parse:!1}))),a(g(l),function(n){var r=l[n];a([e,t],function(e){e.on(n,r);var t=e._events[n]||[];t.unshift(t.pop())})})}},_checkState:function(e){var t=this.mode,r=this.links,i=e.totalRecords,s=e.pageSize,o=e.currentPage,u=e.firstPage,a=e.totalPages;if(null!=i&&null!=s&&null!=o&&null!=u&&("infinite"==t?r:!0)){if(i=n(i,"totalRecords"),s=n(s,"pageSize"),o=n(o,"currentPage"),u=n(u,"firstPage"),1>s)throw new RangeError("`pageSize` must be >= 1");if(a=e.totalPages=b(i/s),0>u||u>1)throw new RangeError("`firstPage must be 0 or 1`");if(e.lastPage=0===u?E(0,a-1):a||u,"infinite"==t){if(!r[o+""])throw new RangeError("No link found for page "+o)}else if(u>o||a>0&&(u?o>a:o>=a))throw new RangeError("`currentPage` must be firstPage <= currentPage "+(u?">":">=")+" totalPages if "+u+"-based. Got "+o+".")}return e},setPageSize:function(e,t){e=n(e,"pageSize"),t=t||{first:!1};var r=this.state,i=b(r.totalRecords/e),u=i?E(r.firstPage,w(i*r.currentPage/r.totalPages)):r.firstPage;return r=this.state=this._checkState(s({},r,{pageSize:e,currentPage:t.first?r.firstPage:u,totalPages:i})),this.getPage(r.currentPage,o(t,["first"]))},switchMode:function(t,n){if(!l(["server","client","infinite"],t))throw new TypeError('`mode` must be one of "server", "client" or "infinite"');n=n||{fetch:!0,resetState:!0};var r=this.state=n.resetState?u(this._initState):this._checkState(s({},this.state));this.mode=t;var i,f=this,c=this.fullCollection,h=this._handlers=this._handlers||{};if("server"==t||c)"server"==t&&c&&(a(g(h),function(e){i=h[e],f.off(e,i),c.off(e,i)}),delete this._handlers,this._fullComparator=c.comparator,delete this.fullCollection);else{c=this._makeFullCollection(n.models||[],n),c.pageableCollection=this,this.fullCollection=c;var p=this._makeCollectionEventHandler(this,c);a(["add","remove","reset","sort"],function(t){h[t]=i=e.bind(p,{},t),f.on(t,i),c.on(t,i)}),c.comparator=this._fullComparator}if("infinite"==t)for(var d=this.links={},v=r.firstPage,m=b(r.totalRecords/r.pageSize),y=0===v?E(0,m-1):m||v,w=r.firstPage;y>=w;w++)d[w]=this.url;else this.links&&delete this.links;return n.fetch?this.fetch(o(n,"fetch","resetState")):this},hasPreviousPage:function(){var e=this.state,t=e.currentPage;return"infinite"!=this.mode?t>e.firstPage:!!this.links[t-1]},hasNextPage:function(){var e=this.state,t=this.state.currentPage;return"infinite"!=this.mode?t<e.lastPage:!!this.links[t+1]},getFirstPage:function(e){return this.getPage("first",e)},getPreviousPage:function(e){return this.getPage("prev",e)},getNextPage:function(e){return this.getPage("next",e)},getLastPage:function(e){return this.getPage("last",e)},getPage:function(e,t){var r=this.mode,i=this.fullCollection;t=t||{fetch:!1};var u=this.state,a=u.firstPage,f=u.currentPage,l=u.lastPage,h=u.pageSize,p=e;switch(e){case"first":p=a;break;case"prev":p=f-1;break;case"next":p=f+1;break;case"last":p=l;break;default:p=n(e,"index")}this.state=this._checkState(s({},u,{currentPage:p})),t.from=f,t.to=p;var d=(0===a?p:p-1)*h,v=i&&i.length?i.models.slice(d,d+h):[];return"client"!=r&&("infinite"!=r||c(v))||t.fetch?("infinite"==r&&(t.url=this.links[p]),this.fetch(o(t,"fetch"))):(this.reset(v,o(t,"fetch")),this)},getPageByOffset:function(e,t){if(0>e)throw new RangeError("`offset must be > 0`");e=n(e);var r=w(e/this.state.pageSize);return 0!==this.state.firstPage&&r++,r>this.state.lastPage&&(r=this.state.lastPage),this.getPage(r,t)},sync:function(e,n,r){var i=this;if("infinite"==i.mode){var o=r.success,u=i.state.currentPage;r.success=function(e,t,n){var a=i.links,f=i.parseLinks(e,s({xhr:n},r));f.first&&(a[i.state.firstPage]=f.first),f.prev&&(a[u-1]=f.prev),f.next&&(a[u+1]=f.next),o&&o(e,t,n)}}return(S.sync||t.sync).call(i,e,n,r)},parseLinks:function(e,t){var n={},r=t.xhr.getResponseHeader("Link");if(r){var i=["first","prev","next"];a(r.split(","),function(e){var t=e.split(";"),r=t[0].replace(T,""),s=t.slice(1);a(s,function(e){var t=e.split("="),s=t[0].replace(x,""),o=t[1].replace(x,"");"rel"==s&&l(i,o)&&(n[o]=r)})})}return n},parse:function(e,t){var n=this.parseState(e,u(this.queryParams),u(this.state),t);return n&&(this.state=this._checkState(s({},this.state,n))),this.parseRecords(e,t)},parseState:function(t,n,r){if(t&&2===t.length&&m(t[0])&&d(t[1])){var i=u(r),s=t[0];return a(h(o(n,"directions")),function(t){var n=t[0],r=t[1],o=s[r];y(o)||e.isNull(o)||(i[n]=s[r])}),s.order&&(i.order=1*p(n.directions)[s.order]),i}},parseRecords:function(e){return e&&2===e.length&&m(e[0])&&d(e[1])?e[1]:e},fetch:function(e){e=e||{};var t=this._checkState(this.state),n=this.mode;"infinite"!=n||e.url||(e.url=this.links[t.currentPage]);var i=e.data||{},a=e.url||this.url||"";v(a)&&(a=a.call(this));var l=a.indexOf("?");-1!=l&&(s(i,r(a.slice(l+1))),a=a.slice(0,l)),e.url=a,e.data=i;var c,p,d,m,b="client"==this.mode?f(this.queryParams,"sortKey","order"):o(f(this.queryParams,g(C.queryParams)),"directions"),w=h(b),E=u(this);for(c=0;c<w.length;c++)p=w[c],d=p[0],m=p[1],m=v(m)?m.call(E):m,null!=t[d]&&null!=m&&(i[m]=t[d]);if(t.sortKey&&t.order){var x=v(b.order)?b.order.call(E):b.order;i[x]=this.queryParams.directions[t.order+""]}else t.sortKey||delete i[b.order];var T=h(o(this.queryParams,g(C.queryParams)));for(c=0;c<T.length;c++)p=T[c],m=p[1],m=v(m)?m.call(E):m,null!=m&&(i[p[0]]=m);if("server"!=n){var N=this,k=this.fullCollection,L=e.success;return e.success=function(t,r,i){i=i||{},y(e.silent)?delete i.silent:i.silent=e.silent;var o=t.models;"client"==n?k.reset(o,i):(k.add(o,s({at:k.length},s(i,{parse:!1}))),N.trigger("reset",N,i)),L&&L(t,r,i)},S.fetch.call(this,s({},e,{silent:!0}))}return S.fetch.call(this,e)},_makeComparator:function(e,t,n){var r=this.state;return e=e||r.sortKey,t=t||r.order,e&&t?(n||(n=function(e,t){return e.get(t)}),function(r,i){var s,o=n(r,e),u=n(i,e);return 1===t&&(s=o,o=u,u=s),o===u?0:u>o?-1:1}):void 0},setSorting:function(e,t,n){var r=this.state;r.sortKey=e,r.order=t=t||r.order;var i=this.fullCollection,o=!1,u=!1;e||(o=u=!0);var a=this.mode;n=s({side:"client"==a?a:"server",full:!0},n);var f=this._makeComparator(e,t,n.sortValue),l=n.full,c=n.side;return"client"==c?l?(i&&(i.comparator=f),o=!0):(this.comparator=f,u=!0):"server"!=c||l||(this.comparator=f),o&&(this.comparator=null),u&&i&&(i.comparator=null),this}}),C=N.prototype;return N}),define("text!apps/commons/pagination/templates/pagination_layout_template.html",[],function(){return'<script>\n	<div class="row list_region"></div>\n	<div class="row pages"></div>\n</script>'}),define("text!apps/commons/pagination/templates/pages_template.html",[],function(){return'<%\nvar currentPage = state.currentPage;\nvar firstPage = state.firstPage;\n%>\n\n<% if (totalPages > 1) { %>\n<div class="text-center">\n  <ul class="pagination">\n    <% if (currentPage > firstPage) { %>\n      <li><a href="#" class="prev">&laquo; Anterior</a></li>\n    <% } %>\n\n    <% var start = currentPage - 2 %>\n    <% var final = currentPage + 2 %>\n    <% start = start < 1 ? 1 : start %>\n    <% final = final >= totalPages ? totalPages : final %>\n\n    <% if (firstPage != currentPage && start >= 2) { %>\n      <li><a href="#" class="page"><%- firstPage%></a></li>\n      <li class="disabled"><a>...</a></li>\n    <% } %>\n\n    <% for (var p = start; p <= final; p++) { %>\n      <% if (currentPage === p) { %>\n        <li class="active"><a class="page"><%- p %> <span class="sr-only">(actual)</span></a></li>\n      <% } else { %>\n        <li><a href="#" class="page"><%- p %></a></li>\n      <% } %>\n    <% } %>\n\n    <% if (totalPages != currentPage && totalPages - final > 0) { %>\n      <li class="disabled"><a>...</a></li>\n      <li><a href="#" class="page"><%- totalPages%></a></li>\n    <% } %>\n    \n    <% if (currentPage < totalPages) { %>\n      <li><a href="#" class="next">Siguiente &raquo;</a></li>\n    <% } %>\n  </ul>\n</div>\n<% } %>'}),define("apps/commons/pagination/paginate",["app","paginator","text!apps/commons/pagination/templates/pagination_layout_template.html","text!apps/commons/pagination/templates/pages_template.html"],function(e,t,n,r){return e.module("CommonsApp.Pagination",function(e,i,s,o,u,a){e.Collection=t.extend({mode:"server",queryParams:{currentPage:null,pageSize:null,totalPages:null,limit:function(){return 100},offset:function(){return(this.state.currentPage-1)*this.state.pageSize}},state:{pageSize:12},initialize:function(e){if(typeof e!="undefined"&&e.url){var t=e.url.split("?");this.url=t[0];if(t.length>1){var n=t[1].split("&"),r,i,s;for(var o=0;o<n.length;o++)r=n[o].split("="),i=r.shift(),s=r.join("="),this.queryParams[i]=s}}},parse:function(e){return this.totalPages=Math.ceil(e.total/this.state.pageSize),e.resources.slice(0,this.state.pageSize)},sync:function(e,n,r){var i=r.success,s=this,o=r.data.offset;r.success=function(e,t,r){s._json=e,i(s._json,n,{})};if(s._json&&s.isOffsetInCollection(o)){var u=a.clone(s._json),f=o-u.offset;u.resources=a.clone(u.resources).slice(f,f+this.state.pageSize),i(u,n,{})}else t.prototype.sync.call(this,e,n,r)},isOffsetInCollection:function(e){var t=e>=this._json.offset&&e<=this._json.offset+this._json.count,n=e-this._json.offset+this.state.pageSize>this._json.count;return t&&!n}}),e.Layout=o.Layout.extend({template:n,regions:{list_region:".list_region",pages_region:".pages"}}),e.PaginationView=o.ItemView.extend({template:a.template(r,this.collection),className:"pagination pagination-centered",events:{"click .prev":"gotoPrev","click .next":"gotoNext","click .page":"gotoPage"},gotoPrev:function(){return this.trigger("goToPrev",this.collection.state.currentPage-1),this.collection.getPreviousPage(),this.render(),this.scrollToTop(),!1},gotoPage:function(e){var t=parseInt(u(e.target).text());return this.trigger("goToPage",t),this.collection.getPage(t),this.render(),this.scrollToTop(),!1},gotoNext:function(e){return this.collection.getNextPage(),this.trigger("goToPage",this.collection.state.currentPage),this.render(),this.scrollToTop(),!1},scrollToTop:function(){this.options.avoidScrollOnPageChange||u("html, body").animate({scrollTop:0},"slow")},serializeData:function(){return this.collection}})}),e.CommonsApp.Pagination}),define("text!apps/commons/list/templates/composite.html",[],function(){return"<script>\n<span>\n</span>\n</script>"}),define("text!apps/commons/list/templates/itemViewTemplate.html",[],function(){return'<script>\n	<a href="/users/<%= username_canonical %>-<%= id %>" data-rel="colorbox" class="cboxElement">\n		<img width=<%= sizeImage.width %> height=<%= sizeImage.height %> style="border: 2px solid #FFF; border-radius: 4px 4px 4px 4px; max-height:150px; max-width:180px;" <%=src_or_data()%>"<% if ((typeof(profile) != "undefined") && (typeof(profile.profile_photo) != "undefined")) { %>\n								<%= profile.profile_photo.path_small %>\n							<% } else { %>\n								<%= window.default_user_image_icon %>\n							<% } %>" title="<%= username %>">\n	</a>\n</script>'}),define("text!apps/commons/list/templates/loading.html",[],function(){return'<script>\n<p><%= message %></p>\n<div id="spinner"></div>\n</script>'}),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("spin",t):e.Spinner=t()}(this,function(){function r(e,t){var n=document.createElement(e||"div"),r;for(r in t)n[r]=t[r];return n}function i(e){for(var t=1,n=arguments.length;t<n;t++)e.appendChild(arguments[t]);return e}function o(e,r,i,o){var u=["opacity",r,~~(e*100),i,o].join("-"),a=.01+i/o*100,f=Math.max(1-(1-e)/r*(100-a),e),l=n.substring(0,n.indexOf("Animation")).toLowerCase(),c=l&&"-"+l+"-"||"";return t[u]||(s.insertRule("@"+c+"keyframes "+u+"{"+"0%{opacity:"+f+"}"+a+"%{opacity:"+e+"}"+(a+.01)+"%{opacity:1}"+(a+r)%100+"%{opacity:"+e+"}"+"100%{opacity:"+f+"}"+"}",s.cssRules.length),t[u]=1),u}function u(t,n){var r=t.style,i,s;if(r[n]!==undefined)return n;n=n.charAt(0).toUpperCase()+n.slice(1);for(s=0;s<e.length;s++){i=e[s]+n;if(r[i]!==undefined)return i}}function a(e,t){for(var n in t)e.style[u(e,n)||n]=t[n];return e}function f(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]===undefined&&(e[r]=n[r])}return e}function l(e){var t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function h(e){if(typeof this=="undefined")return new h(e);this.opts=f(e||{},h.defaults,c)}function p(){function e(e,t){return r("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}s.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(t,n){function o(){return a(e("group",{coordsize:s+" "+s,coordorigin:-r+" "+ -r}),{width:s,height:s})}function c(t,s,u){i(f,i(a(o(),{rotation:360/n.lines*t+"deg",left:~~s}),i(a(e("roundrect",{arcsize:n.corners}),{width:r,height:n.width,left:n.radius,top:-n.width>>1,filter:u}),e("fill",{color:n.color,opacity:n.opacity}),e("stroke",{opacity:0}))))}var r=n.length+n.width,s=2*r,u=-(n.width+n.length)*2+"px",f=a(o(),{position:"absolute",top:u,left:u}),l;if(n.shadow)for(l=1;l<=n.lines;l++)c(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=n.lines;l++)c(l);return i(t,f)},h.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}}var e=["webkit","Moz","ms","O"],t={},n,s=function(){var e=r("style",{type:"text/css"});return i(document.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),c={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};h.defaults={},f(h.prototype,{spin:function(e){this.stop();var t=this,i=t.opts,s=t.el=a(r(0,{className:i.className}),{position:i.position,width:0,zIndex:i.zIndex}),o=i.radius+i.length+i.width,u,f;e&&(e.insertBefore(s,e.firstChild||null),f=l(e),u=l(s),a(s,{left:(i.left=="auto"?f.x-u.x+(e.offsetWidth>>1):parseInt(i.left,10)+o)+"px",top:(i.top=="auto"?f.y-u.y+(e.offsetHeight>>1):parseInt(i.top,10)+o)+"px"})),s.setAttribute("role","progressbar"),t.lines(s,t.opts);if(!n){var c=0,h=(i.lines-1)*(1-i.direction)/2,p,d=i.fps,v=d/i.speed,m=(1-i.opacity)/(v*i.trail/100),g=v/i.lines;(function y(){c++;for(var e=0;e<i.lines;e++)p=Math.max(1-(c+(i.lines-e)*g)%v*m,i.opacity),t.opacity(s,e*i.direction+h,p,i);t.timeout=t.el&&setTimeout(y,~~(1e3/d))})()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=undefined),this},lines:function(e,t){function l(e,n){return a(r(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*s+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.corners*t.width>>1)+"px"})}var s=0,u=(t.lines-1)*(1-t.direction)/2,f;for(;s<t.lines;s++)f=a(r(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:n&&o(t.opacity,t.trail,u+s*t.direction,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&i(f,a(l("#000","0 0 4px #000"),{top:"2px"})),i(e,i(f,l(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}});var d=a(r("group"),{behavior:"url(#default#VML)"});return!u(d,"transform")&&d.adj?p():n=u(d,"animation"),h}),function(e){if(typeof exports=="object")e(require("jquery"),require("spin"));else if(typeof define=="function"&&define.amd)define("spin.jquery",["jquery","spin"],e);else{if(!window.Spinner)throw new Error("Spin.js not present");e(window.jQuery,window.Spinner)}}(function(e,t){e.fn.spin=function(n,r){return this.each(function(){var i=e(this),s=i.data();s.spinner&&(s.spinner.stop(),delete s.spinner),n!==!1&&(n=e.extend({color:r||i.css("color")},e.fn.spin.presets[n]||n),s.spinner=(new t(n)).spin(this))})},e.fn.spin.presets={tiny:{lines:8,length:2,width:2,radius:3},small:{lines:8,length:4,width:3,radius:5},large:{lines:10,length:8,width:4,radius:8}}}),define("apps/commons/list/listView",["app","text!apps/commons/list/templates/composite.html","text!apps/commons/list/templates/itemViewTemplate.html","apps/commons/list/emptyView","text!apps/commons/list/templates/loading.html","util/lazyloaderhelper","spin.jquery"],function(e,t,n,r,i,s){return e.module("Commons.List",function(e,o,u,a,f,l){var c=a.ItemView.extend({tagName:'li class="col-xs-3"',template:n,initialize:function(e){this.tagName=this.options.tagName,this.delegateEventsToParentView(),e.lazy&&s(this)},templateHelpers:function(){var e=this;return{src_or_data:function(){return e.options.lazy?'class="lazy" data-original=':"src="}}},serializeData:function(){var e=function(t){var n={};return l.each(t.attributes,function(t,r){l.isFunction(t.toJSON)?n[r]=e(t):n[r]=t}),n},t=e(this.model);return l.extend(t,{sizeImage:this.options.sizeImage}),t},delegateEventsToParentView:function(){var e=/^(\S+)\s*(.*)$/;if(this.options.toParentEvents){var t=this.options.toParentEvents;for(var n in t){var r=t[n],i=n.match(e),s=i[1],o=i[2];this.delegateEventToParentView(s,o,r)}}},delegateEventToParentView:function(e,t,n){var r=this.options.parentView,i=l.bind(r[n],r,this);t===""?this.$el.on(e,i):this.$el.on(e,t,i)}});e.CompositeView=u.Marionette.CompositeView.extend({tagName:'ul class="row list-unstyled"',itemView:c,emptyView:r.EmptyView,template:t,itemViewOptions:function(e,t){var n={template:this.options.templateItemView};return this.options.tagNameItemView&&l.extend(n,{tagName:this.options.tagNameItemView}),this.options.sizeImage&&(f.isPlainObject(this.options.sizeImage)?l.extend(n,{sizeImage:this.options.sizeImage}):l.extend(n,{sizeImage:{width:this.options.sizeImage,height:this.options.sizeImage}})),this.subviewEvents&&l.extend(n,{toParentEvents:this.subviewEvents,parentView:this}),this.options.lazy&&l.extend(n,{lazy:!0}),this.options.perserveOriginalTemplate&&l.extend(n,{perserveOriginalTemplate:!0}),n}}),e.Loading=a.ItemView.extend({template:i,initialize:function(e){var t=e||{};this.title=t.title||"Loading Data",this.message=t.message||"Please wait, data is loading."},serializeData:function(){return{title:this.title,message:this.message}},onShow:function(){var e={lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"30px",left:"auto"};f("#spinner").spin(e)}})}),e.Commons.List}),define("apps/channels/list/list_controller",["app","apps/channels/list/list_view","apps/commons/pagination/paginate","apps/commons/list/listView"],function(e,t,n,r){return e.module("ChannelsApp.List",function(e,i,s,o,u,a){var f=null;e.Controller={listOutstandingChannels:function(){var e=i.request("channel:entities:outstanding"),s=new t.Layout,o=new n.Layout,a=new r.Loading({message:"Reading Channels."});o.on("show",function(){o.pages_region.show(a)}),s.on("show",function(){s.index_medium_Region.show(o)}),i.container_center_Region.show(s),u.when(e).done(function(e){o.pages_region.reset(),requirejs(["text!apps/channels/list/templates/popular_composite_list_template.html"],function(n){o.list_region.show(new t.ItemsListView({collection:e,template:n,columns:6,itemView:t.PopularItemView}))})}).fail(function(e){requirejs(["apps/commons/errors/generic"],function(t){i.container_center_Region.show(new t.GenericErrorView({model:e}))})})},listChannels:function(s,o){s?s=parseInt(s):s=1;var a=new t.Layout,l;f=o,typeof o=="undefined"||u.isEmptyObject(o)?l=new n.Collection({url:window.api_endpoint+"/api/channels"}):l=new n.Collection({url:window.api_endpoint+"/api/channels?"+o});var c=new n.Layout,h=new r.Loading({message:"Reading Channels."});a.on("show",function(){c.on("render",function(){e.Controller._fetchChannelCollection(l,c,s)}),c.on("show",function(){c.pages_region.show(h)}),a.index_medium_Region.show(c)}),i.container_center_Region.show(a)},_fetchChannelCollection:function(e,r,s){requirejs(["text!apps/channels/list/templates/composite_list_template.html"],function(o){e.fetch({reset:!0,success:function(u){var a=new n.PaginationView({collection:e});e.getPage(s);var l=function(){return f===null?"":"?"+f};a.on("goToPage",function(e){i.navigate("rooms/page/"+e+l())}),a.on("gotoNext",function(e){i.navigate("rooms/page/"+e+l())}),a.on("goToPrev",function(e){i.navigate("rooms/page/"+e+l())}),r.pages_region.show(a),r.list_region.show(new t.ItemsListView({collection:e,template:o,columns:6}))},error:function(e,t,n){requirejs(["apps/commons/errors/generic"],function(e){i.container_center_Region.show(new e.GenericErrorView({model:t}))})},silent:!0})})}}}),e.ChannelsApp.List.Controller});