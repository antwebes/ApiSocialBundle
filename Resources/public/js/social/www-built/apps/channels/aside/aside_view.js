define(["app","text!apps/channels/aside/templates/asideViewTemplate.html","handlebars","util/lazyloaderhelper"],function(e,t,n,r){return e.module("ChannelsApp.Aside.View",function(e,i,s,o,u,a){e.ChannelSidebarView=o.View.extend({template:t,initialize:function(){this.model.on("change",this.render,this),r(this)},events:{"click #makeFan":"makeFan","click #stopBeingFan":"stopBeingFan"},triggers:{"click #view-all-fans":"channel:show:fans"},render:function(){n.registerHelper("isFan",function(e,t){for(var n in e.models)if(e.models[n].id==window.user_id)return t.fn(this);return t.inverse(this)});var e=n.compile(this.template);return this.$el.html(e(this.model.attributes)),requirejs(["apps/commons/socialNetwork/socialNetwork"],function(e){u("#main_container_social_network").html((new e.ShareSocialNetwork).render().el)}),this},onShow:function(){var e=this,t=new s.Collection(e.model.get("fans").slice(0,8));requirejs(["apps/commons/list/listView"],function(e){u("#usersFans").html((new e.CompositeView({collection:t,tagName:'ul class="list-unstyled"',sizeImage:"70px"})).render().el)})},makeFan:function(){var e=this;u.ajax({type:"POST",url:window.api_endpoint+"/api/users/"+window.user_id+"/channels/"+this.model.get("id")+"/fans",success:function(t){i.User.get("channels_fan").add(e.model),e.model.get("fans").add(i.User),e.onShow(),i.sendEventAnalytics("event","Fan","DoFan",e.model.get("id")),u("#makeFan").attr("id","stopBeingFan"),document.getElementById("wrapMakeFanText").innerHTML='<span id="wrapMakeFanText">Stop being fan</span>'},error:function(t,n,r){var i=u.parseJSON(t.responseText),s=e.$el.find(".alert-danger");i.code==32&&(i.errors="An error happend"),s.show().html(i.errors)}})},stopBeingFan:function(){var e=this;require(["apps/commons/dialog/dialog_view"],function(t){t.confirm("Are you sure you don't wanna be more fan of this channel?","Stop being fan").then(function(t){t&&u.ajax({type:"DELETE",url:window.api_endpoint+"/api/users/"+window.user_id+"/channels/"+e.model.get("id")+"/fans",success:function(t){i.User.get("channels_fan").remove(e.model),i.User.get("channels_fan").add(e.model),e.model.get("fans").remove(i.User),i.sendEventAnalytics("event","Fan","UndoFan",e.model.get("id")),e.onShow(),u("#stopBeingFan").attr("id","makeFan"),document.getElementById("wrapMakeFanText").innerHTML='<span class="bigger-110" id="wrapMakeFanText" >Make fan</span>'},error:function(t,n,r){var i=u.parseJSON(t.responseText),s=e.$el.find(".alert-danger");i.code==32&&(i.errors="An error happend"),s.show().html(i.errors)}})})})}})}),e.ChannelsApp.Aside.View});