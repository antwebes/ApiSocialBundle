define(["app","text!apps/channels/form/templates/form_layout_Template.html","backbone-bootstrap","backbone-forms","text!util/languages_min.js","util/util"],function(e,t,n,r,i){return e.module("ChannelsApp.Form",function(e,n,s,o,u,a){function l(e,t,n){u(t).hide(),u(e).html(""),u(e).removeClass("hide"),u(e).show(),u(e).html(n)}var f=null;e.Layout=o.Layout.extend({template:t,regions:{form_Region:"#form_show",alert_danger_Region:"#alert-danger",alert_success_Region:"#alert-success"},triggers:{"click #upload":"upload","click #assigne":"assigne"},events:{"click #commit":"formCommit","click #delete":"deleteClick"},initialize:function(e){this.type=e.type,this.model.on("sync",this.onSync,this),this.model.on("error",this.onError,this),this.model.on("destroy",this.onDestroy,this)},onSync:function(e,t,n){},onError:function(e,t,n){var r=this,i="",s;t.responseJSON!==undefined?s=t.responseJSON:s=JSON.parse(t.responseText),s.code===32||s.code===60?i=t.responseJSON.errors:u.each(s.errors,function(e,t){i+=e+" : "+t.message+"\n"}),l(this.regions.alert_danger_Region,this.regions.alert_success_Region,i)},onDestroy:function(e,t,n){s.history.navigate("rooms/",!0)},onShow:function(){u.ajax({dataType:"json",url:window.api_endpoint+"/api/channel/modes",success:function(e){u("ul[name=modes]").empty(),a.each(e,function(e,t){var n="<li>";n+='<input type="checkbox" id="c10_modes-'+t+'" value=\'{"mode":"'+e.name.charAt(0).toLowerCase()+'","value":""}\' name="modes">',n+='<label for="c10_modes-'+t+'">'+e.name+"</label>",e.is_value_required&&(n+='<input type="text" name="'+e.name+'"/>'),n+="</li>",u("ul[name=modes]").append(n)})},error:function(e){}});var e=JSON.parse(i);u("select[name=language]").find("option").remove().end(),u.each(e,function(e,t){u("select[name=language]").append("<option value="+e+">"+t.name+"</option>")}),u('select[name=language] option:contains("English")').prop("selected",!0)},onClose:function(){this.model.off()},onRender:function(){u(this.alert_success_Region.el).removeClass("hide"),u(this.alert_danger_Region.el).hide(),this.form_Region.show(new e.FormView({model:this.model,type:this.type}))},formCommit:function(){var e=this;u(this.alert_success_Region.el).hide(),u(this.alert_danger_Region.el).hide();var t=f.commit({validate:!0}),r=f.getValue();if(typeof t=="undefined"){var i=this.model.get("modes"),s=u.trim(i),o='{"modes": ['+s+"]}";try{var a=JSON.parse(o);this.model.set({modes:a.modes})}catch(c){}this.model.save({description:r.description},{patch:!0,success:function(t){l(e.regions.alert_success_Region,e.regions.alert_danger_Region,"Data sent successfully"),e.type=="create"&&n.trigger("photos:upload",{message:"Upload photo to channel: "+e.model.get("name"),done:function(t,r){e.model.changePhoto(r.result.id),r.context.text("Upload finished."),n.trigger("dashboard:channels_pendings_to_moderate")}})}})}},deleteClick:function(){var e=this;require(["apps/commons/dialog/dialog_view"],function(t){t.confirm("Are you sure you want to delete this channel?","Delete channel").then(function(t){t&&e.model.destroy()})})}}),e.FormView=o.View.extend({type:null,initialize:function(e){this.type=e.type},render:function(){var e=new r({model:this.model});return this.type=="edit"&&(typeof this.model.attributes.channel_type!="undefined"&&(e.fields.channel_type.editor.value=this.model.attributes.channel_type.name),e.fields.channel_type.editor.$el.attr("disabled",!0),e.fields.name.editor.$el.attr("disabled",!0),e.fields.irc_channel.editor.$el.attr("disabled",!0)),u(this.el).html(""),u(this.el).html(e.render().el),f=e,f.on("name:change",function(e,t){var n=slug(t.previousValue);e.setValue({irc_channel:n})}),this}})}),e.ChannelsApp.Form});