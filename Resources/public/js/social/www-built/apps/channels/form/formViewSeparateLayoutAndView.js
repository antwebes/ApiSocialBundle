define(["app","text!apps/channels/form/templates/form_layout_Template.html","backbone-bootstrap","backbone-forms","text!util/languages_min.js","text!apps/channels/form/templates/form_view_template.html","text!apps/channels/form/templates/form_view_scripts.html","util/util"],function(e,t,n,r,i,s,o){return e.module("ChannelsApp.Form",function(e,n,r,u,a,f){function l(e,t,n){a(t).hide(),a(e).html(""),a(e).removeClass("hide"),a(e).show(),a(e).html(n)}e.Layout=u.Layout.extend({template:t,regions:{form_Region:"#form_show",alert_danger_Region:"#alert-danger",alert_success_Region:"#alert-success"},triggers:{"click #upload":"upload","click #assigne":"assigne"},events:{"click #commit":"formCommit","click #delete":"deleteClick"},initialize:function(e){this.type=e.type,this.form=e.form,this.model.on("sync",this.onSync,this),this.model.on("error",this.onError,this),this.model.on("destroy",this.onDestroy,this)},onError:function(e,t,n){var r=this,i="",s;if(t.responseJSON!==undefined)s=t.responseJSON;else try{s=JSON.parse(t.responseText)}catch(o){s={code:32,errors:"An error has ocurred. Please try it later"}}s.code===32||s.code===60?i=s.errors:a.each(s.errors,function(e,t){i+=e+" : "+t.message+"\n"}),l(this.regions.alert_danger_Region,this.regions.alert_success_Region,i)},onDestroy:function(e,t,n){r.history.navigate("rooms/",!0)},onClose:function(){this.model.off()},onRender:function(){a(this.alert_success_Region.el).removeClass("hide"),a(this.alert_danger_Region.el).hide()},formCommit:function(){var e=this;a(this.alert_success_Region.el).hide(),a(this.alert_danger_Region.el).hide();var t=this.form.commit({validate:!0}),r=this.form.getValue();if(typeof t=="undefined"){var i=this.model.get("modes"),s=a.trim(i),o='{"modes": ['+s+"]}";try{var u=JSON.parse(o);this.model.set({modes:u.modes})}catch(f){}this.model.save({description:r.description},{patch:!0,success:function(t){l(e.regions.alert_success_Region,e.regions.alert_danger_Region,"Data sent successfully"),n.User.get("channels").add(e.model),e.type=="create"&&n.trigger("photos:upload",{message:"Upload photo to channel: "+e.model.get("name"),done:function(t,r){e.model.changePhoto(r.id),n.trigger("dashboard:channels_pendings_to_moderate"),n.sendEventAnalytics("event","Rooms","CreateRoom")}})}})}},deleteClick:function(){var e=this;require(["apps/commons/dialog/dialog_view"],function(t){t.confirm("Are you sure you want to delete this channel?","Delete channel").then(function(t){t&&e.model.destroy()})})}}),e.FormViewScript=u.ItemView.extend({template:o}),e.FormView=u.ItemView.extend({template:s,type:null,initialize:function(e){this.type=e.type,this.form=e.form},onRender:function(){var e=this;return this.type=="edit"&&(typeof this.model.attributes.channel_type!="undefined"&&(this.form.fields.channel_type.editor.value=this.model.attributes.channel_type.name),this.form.fields.channel_type.editor.$el.attr("disabled",!0),this.form.fields.name.editor.$el.attr("disabled",!0),this.form.fields.irc_channel.editor.$el.attr("disabled",!0)),a(this.el).empty().append(this.form.render().el),this.form.on("name:change",function(t,n){var r=slug(n.previousValue);e.form.setValue({irc_channel:r})}),this},onShow:function(){a(this.el).append((new e.FormViewScript).render().el);var t=JSON.parse(i);a("select[name=language]").find("option").remove().end(),a.each(t,function(e,t){a("select[name=language]").append("<option value="+e+">"+t.name+"</option>")}),this.type=="edit"||this.model.get("language")?a('select[name=language] option[value="'+this.model.get("language")+'"]').prop("selected",!0):a('select[name=language] option:contains("English")').prop("selected",!0),a.ajax({dataType:"json",url:window.api_endpoint+"/api/channel/modes",success:function(e){a("ul[name=modes]").empty(),f.each(e,function(e,t){var n="<li>";n+='<input type="checkbox" id="c10_modes-'+t+'" value=\'{"mode":"'+e.name.charAt(0).toLowerCase()+'","value":""}\' name="modes">',n+='<label for="c10_modes-'+t+'">'+e.name+"</label>",e.is_value_required&&(n+='<input type="text" name="'+e.name+'"/>'),n+="</li>",a("ul[name=modes]").append(n)})},error:function(e){}})}})}),e.ChannelsApp.Form});