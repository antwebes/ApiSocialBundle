define(["app","text!apps/chat/show/templates/chat_layout.html","text!apps/chat/show/templates/chat_template.html","text!apps/chat/show/templates/index_kiwi.html","text!apps/chat/show/templates/privat_url_widget_template.html","ZeroClipboard",window.kiwi_server+"/kiwi/assets/libs/engine.io.js","toastr"],function(e,t,n,r,i,s,o,u){function a(e){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}return e.module("ChatApp.Show.View",function(e,f,l,c,h,p){e.Layout=c.Layout.extend({template:t,regions:{body_container_Region:"#body_container",private_url_widget_Region:"#private_url_widget"}}),e.ChatView2=c.View.extend({template:r,initialize:function(e){this.options=e,this.pendingMessages=0},render:function(){a(require.toUrl("toastr_css"));var t=this;this.options.channel?this.options.joinChatsfree&&(this.options.channel=this.options.channel+",chatsfree"):this.options.channel="#chatsfree",window.eio=o;var n=document.getElementById("tab_show_hide");n||(h(".ace-nav").prepend('<li class="grey" id="tab_show_hide"><a class="show_hide dropdown-toggle" data-toggle="dropdown"><i class="fa fa-comments"></i> <span>Chat</span><span class="badge badge-grey" id="pendingMessages"></span></a></li>'),h(".show_hide").show(),h(".show_hide").click(function(){h(".chat").slideToggle(),h(".social").slideToggle(),h(".chat").is(":visible")&&(t.pendingMessages=0,h("#pendingMessages").html(""))})),e._showChatHideSocial();var r="{{ kiwi_server }}",i=new RegExp(r,"g");return this.$el.html(this.template.replace(i,window.kiwi_server)),this},onShow:function(){var t=this;window.onChatRendered=function(n){n.plugins.on("loaded",function(){t.options.nick&&h("#server_select_nick").val(t.options.nick),t.options.channel&&h("#server_select_channel").val(t.options.channel);var r=n.components.Network();r._source.bind("connection:connect",function(e){window.chat_connected=!0,typeof t.options.private!="undefined"&&f.trigger("chat:command:query",t.options.private)}),r._source.bind("connection:message",function(n){n.type=="message"&&(h(".chat").is(":visible")||(t.pendingMessages++,h("#pendingMessages").html(t.pendingMessages),n.target[0]!="#"&&u.info(n.msg,"New message from "+n.nick,{positionClass:"toast-bottom-right",closeButton:!0,onclick:function(){t.pendingMessages=0,f.trigger("chat:command:query",n.nick),e._showChatHideSocial()}})))}),typeof t.options.user!="undefined"&&!t.options.user.get("enabled")&&n.blockUrlsAndEmails(),h(".server_select").hide(),h("form button").click()})},window.chat_render()}}),e.PrivatUrlWidget=c.View.extend({template:p.template(i),render:function(){this.$el.html(this.template);var e=require.toUrl("ZeroClipboardSwf");s.config({moviePath:e});var t=new s(h(this.el).find("#copy_url"));t.on("copy",function(){})}}),e.ChatView=c.View.extend({template:n,render:function(){var t=document.getElementById("tab_show_hide");t||(h(".ace-nav").prepend('<li class="grey" id="tab_show_hide"><a class="show_hide dropdown-toggle" data-toggle="dropdown"><i class="fa fa-tasks"></i><span class="badge badge-grey">show/hide</span></a></li>'),h(".show_hide").show(),h(".show_hide").click(function(){h(".chat").slideToggle(),h(".social").slideToggle()})),e._showChatHideSocial(),this.options.channel?this.options.joinChatsfree&&(this.options.channel=this.options.channel+",chatsfree"):this.options.channel="#chatsfree";var r=p.template(n,this.options);h(this.el).append(r);var i=require.toUrl("ZeroClipboardSwf");s.config({moviePath:i});var o=new s(h(this.el).find("#copy_url"));return o.on("copy",function(){}),this}}),e._showChatHideSocial=function(){h(".chat").show(),h(".social").hide(),h("#pendingMessages").html("")}}),e.ChatApp.Show.View});