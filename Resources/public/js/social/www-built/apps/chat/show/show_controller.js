define(["app","apps/chat/show/show_view","apps/chat/command/command","entities/user"],function(e,t){return e.module("ChatApp.Show",function(e,n,r,i,s,o){e.Controller={show:function(t){typeof t=="string"&&(t=JSON.parse('{"'+decodeURI(t.replace(/&/g,'","').replace(/=/g,'":"'))+'"}')),t?t.isPrivateChat=!1:(t={},t.isPrivateChat=!1);var r=n.request("user:entity",window.user_id);typeof t.nick=="undefined"?s.when(r).done(function(n){t.nick=n.get("username"),t.user=n,e.Controller._show(t,!1)}).fail(function(e){requirejs(["apps/commons/errors/generic"],function(t){n.container_center_Region.show(new t.GenericErrorView({model:e}))})}):e.Controller._show(t,!1)},showPrivate:function(t,r){t===undefined&&(t=this.uniqid()),typeof r=="undefined"?r={nick:user.get("username"),channel:t,joinChatsfree:!1,isPrivateChat:!0}:r={channel:t,joinChatsfree:!1,isPrivateChat:!0};var i=n.request("user:entity",window.user_id);s.when(i).done(function(t){r.user=t,e.Controller._show(r,!0)}).fail(function(e){requirejs(["apps/commons/errors/generic"],function(t){n.container_center_Region.show(new t.GenericErrorView({model:e}))})})},_show:function(r,i){var o=typeof r!="undefined"&&r!==null,u=document.getElementById("tab_show_hide");if(u){t._showChatHideSocial(),n.body_container_chat_Region.currentView.body_container_Region.currentView.pendingMessages=0,o&&(typeof r.private!="undefined"&&n.trigger("chat:command:query",r.private),typeof r.channel!="undefined"&&n.trigger("chat:command:join",r.channel));return}if(o)r.joinChatsfree||(r.joinChatsfree=!0),typeof r.channel!="undefined"&&(r.channel.substring(0,3)==="%23"?r.channel="#"+r.channel.substring(3):r.channel[0]!="#"&&(r.channel="#"+r.channel)),e.Controller._onShowChatLayoutInsertRegionApp(r,i);else{var a=n.request("user:entity",window.user_id);s.when(a).done(function(t){r={nick:t.get("username")},e.Controller._onShowChatLayoutInsertRegionApp(r,i)})}},_onShowChatLayoutInsertRegionApp:function(e,r){var i=new t.Layout;i.on("show",function(){i.body_container_Region.show(new t.ChatView2(e)),r&&i.private_url_widget_Region.show(new t.PrivatUrlWidget)}),n.body_container_chat_Region.show(i)}}}),e.ChatApp.Show.Controller});