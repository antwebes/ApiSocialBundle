define(["app","text!apps/commons/chat/templates/chat_template.html","text!apps/commons/chat/templates/enter_chat_template.html"],function(e,t,n){return e.module("Commons.Views",function(e,r,i,s,o,u){e.widgetTwoChat=s.ItemView.extend({template:t,events:{"click #goChatPrivate":"goChatPrivate","click #goChat":"goChat"},goChatPrivate:function(){requirejs(["util/util"],function(){var e=this.uniqid();r.trigger("chat:private:show",e)})},goChat:function(){r.sendEventAnalytics("event","Home","Chat","#chatsfree");var e=r.request("user:entity:me",window.user_id);o.when(e).done(function(e){r.trigger("chat:show",{nick:e.get("username")})})}}),e.widgetChat=s.ItemView.extend({template:n,events:{"click #goChat":"renderChat"},serializeData:function(){return this.options.nick?{nick:this.options.nick}:{}},renderChat:function(){o.ajax({type:"PUT",url:window.api_endpoint+"/api/channels/"+this.model.get("id")+"/visits"}),r.sendEventAnalytics("event","Rooms","Chat",this.model.get("irc_channel")),r.trigger("chat:show",{channel:this.model.get("irc_channel"),nick:this.getUserEnteredNick()})},getUserEnteredNick:function(){var e=(this.$el.find("#username").val()||"").replace(/^\s+|\s+$/gm,"");return e===""?r.User.get("username"):e}})}),e.Commons.Views});