define(["app","entities/user","entities/channel"],function(e){return e.module("Entities.Quote",function(e,t,n,r,i,s){e.Quote=n.Model.extend({urlRoot:window.api_endpoint+"/api/quotes",schema:{creator:{validators:["required"]},body:{type:"TextArea",validators:["required"]},channel:{validators:["required"]}}}),e.QuoteCollection=n.Collection.extend({url:"http://api.chateagratis.local/app_dev.php/api/quotes",model:e.Quote,initialize:function(e){e&&(typeof e.parameters=="undefined"&&(this.url=this.url+"?limit=36"),this.url=this.url+e.parameters)},parse:function(e){return e.resources}});var o={getQuoteEntity:function(n){var r=new e.Quote({id:n}),s=i.Deferred();return r.fetch({success:function(e){e.set("creator",t.request("user:entity:new"),e.creator),e.get("creator").url=function(){return e.attributes._links.creator.href},e.set("channel",t.request("channel:entity:new"),e.board),e.get("channel").url=function(){return e.attributes._links.channel.href},s.resolve(e)},error:function(e,t,n){s.reject(t)}}),s.promise()},getQuoteEntities:function(t){var n=new e.ChannelCollection({parameters:t}),r=i.Deferred();n.fetch({reset:!0,success:function(e){r.resolve(e)},error:function(e,t,n){r.reject(t)}});var s=r.promise();return i.when(s).done(function(e){e.length===0&&e.reset(models)}),s}};t.reqres.setHandler("quote:entity",function(e){return o.getQuoteEntity(e)}),t.reqres.setHandler("quote:entity:new",function(t){return new e.Quote(t)}),t.reqres.setHandler("quote:entities",function(e){return o.getQuoteEntities(e)})}),e.Entities.Channel});