define(["app"],function(e){return e.module("Entities",function(e,t,n,r,i,s){e.Message=n.Model.extend({urlRoot:window.api_endpoint+"/api/users/"+window.user_id+"/threads",initialize:function(e){e.thread&&(this.urlRoot=this.urlRoot+"/"+e.thread.id)},schema:{body:{validators:["required"],type:"TextArea",editorClass:"wysiwyg-editor",editorAttrs:{cols:"120",rows:"50",placeholder:"Message"}}},toJSON:function(){var e=n.Model.prototype.toJSON.apply(this,arguments);return{message:e}}}),e.MessageCollection=n.Collection.extend({url:window.api_endpoint+"/api/users/"+window.user_id+"/threads/",model:e.Message,initialize:function(e){typeof e.thread_id!="undefined"&&(this.url=this.url+e.thread_id)},parse:function(e){return e}}),e.Recipient=n.Model.extend({label:function(){return this.get("username")}}),e.RecipientsCollection=n.Collection.extend({model:e.Recipient,url:function(){return window.api_endpoint+"/api/users/"},sync:function(e,t,r){var i=r.data.query;delete r.data.query,r.url=this.url()+i+"/search",n.Collection.prototype.sync.call(this,e,t,r)}});var o={getMessagesOfThread:function(t){var n=new e.MessageCollection({thread_id:t}),r=i.Deferred();n.fetch({success:function(e){r.resolve(e)},error:function(e,t,n){r.reject(t)}});var s=r.promise();return s}};t.reqres.setHandler("thread:messages",function(e){return o.getMessagesOfThread(e)})}),e.Entities});