define(["app"],function(e){return e.module("Entities.Photo",function(e,t,n,r,i,s){e.Photo=n.Model.extend({urlRoot:window.api_endpoint+"/api/photos",schema:{title:{}}}),e.PhotoCollection=n.Collection.extend({initialize:function(e){this.userId=e.userId},url:function(){return window.api_endpoint+"/api/users/"+this.userId+"/photos"},model:e.Photo,parse:function(e){return e.resources}});var o={getPhotoEntity:function(t){var n=new e.Photo({id:t}),r=i.Deferred();return n.fetch({success:function(e){r.resolve(e)},error:function(e,t,n){r.reject(t)}}),r.promise()},getPhotoEntities:function(t){var n=new e.PhotoCollection({userId:t}),r=i.Deferred();n.fetch({success:function(e){r.resolve(e)},error:function(e,t,n){r.reject(t)}});var s=r.promise();return i.when(s).done(function(e){e.length===0}),s},assigneProfilePhoto:function(e,n,r,s){i.ajax({dataType:"json",type:"patch",data:{photo_id:n},url:window.api_endpoint+"/api/users/"+e+"/profile_photo",success:function(e){var n=t.request("photo:entity:new",e);t.User.get("profile")?t.User.get("profile").set("profile_photo",n):requirejs(["entities/profile"],function(){var e=t.request("profile:entity:new",window.user_id);t.User.set("profile",e),t.User.get("profile").set("profile_photo",n)}),r()},error:function(){s()}})},assigneChannelPhoto:function(e,t,n,r){i.ajax({dataType:"json",type:"patch",data:{photo_id:t},url:window.api_endpoint+"/api/users/"+e.get("owner").id+"/channels/"+e.get("id")+"/photo",success:function(e){n()},error:function(){r()}})}};t.reqres.setHandler("photo:entity",function(e){return o.getPhotoEntity(e)}),t.reqres.setHandler("photo:entity:new",function(t){return t?new e.Photo(t):new e.Photo}),t.reqres.setHandler("photo:entities",function(e){return o.getPhotoEntities(e)}),t.reqres.setHandler("user:profile_photo:assigne",function(e,t,n,r){n=n||function(){},r=r||function(){},o.assigneProfilePhoto(e,t,n,r)}),t.reqres.setHandler("channel:photo:assigne",function(e,t,n,r){n=n||function(){},r=r||function(){},o.assigneChannelPhoto(e,t,n,r)})}),e.Entities.Photo});