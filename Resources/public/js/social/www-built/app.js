define(["marionette","backbone","underscore","handlebars","moment","iecors","translate"],function(e,t,n,r,i){function u(){var e=navigator.userAgent||navigator.vendor||window.opera;return/iPhone|iPod|iPad|Android|BlackBerry|Opera Mini|IEMobile/.test(e)}var s=t.Model.prototype.parse;t.Model.prototype.parse=function(){var e=s.apply(this,arguments),t=/(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})[+-](\d{4})/,r=function(e){n.each(e,function(i,s){n.isString(i)&&t.test(i)?e[s]=new Date(i):n.isObject(i)&&r(e[s])})};return r(e),e},r.registerHelper("formatDate",function(e,t){return i(e).format(t)}),r.registerHelper("relativeFromNow",function(e){return i(e).calendar()}),r.registerHelper("globalVar",function(e){return window[e]});var o=new e.Application;return o.addRegions({headerRegion:"header",leftRegion:"#sidebar",body_container_main_Region:"#body_container_main",container_center_Region:"#body_container_main",body_container_chat_Region:"#body_container_chat",container_left_Region:"#body_container_left"}),o.navigate=function(e,n){n=n||{},t.history.navigate(e,n)},$.ajaxSetup({beforeSend:function(e,t){t.url.indexOf(window.kiwi_server)==-1&&e.setRequestHeader("Authorization","Bearer "+window.token)}}),o.mobile=u(),window.debug_mode?o.root="/app_dev.php/":o.root="/",o.startSubApp=function(e,t){var n=e?o.module(e):null;if(o.currentApp===n)return;o.currentApp&&o.currentApp.stop(),o.currentApp=n,n&&n.start(t)},o.on("initialize:after",function(e){var n="en";typeof e.lang!="undefined"&&(n=e.lang),i.lang(n),require(["text!translations/es.json","text!translations/en.json"],function(e,t){var i="{}";n=="es"?i=e:n=="en"&&(i=t);var s=JSON.parse(i),u=window.libTranslate.getTranslationFunction(s),a=function(){return u.apply(null,arguments)};o.reqres.setHandler("trans",a),r.registerHelper("t",a)}),require(["apps/messages/messages_app"],function(){t.history.start({pushState:!0,root:o.root}),t.history&&t.history._hasPushState&&$(document).delegate("a","click",function(e){if($(this).hasClass("no_navigate")||$(this).attr("target")=="_blank")return;var n=$(this).attr("href"),r=this.protocol+"//";if(typeof n!="undefined"){if(n.indexOf("/auth/logout")!=-1)return;if(n.slice(r.length)!==r)return e.preventDefault(),t.history.navigate(n,!0),!1}}),t.history.on("route",function(e,t){o.onPostNavigate()}),o.vent.trigger("socialapp:loaded")})}),$(document).on("click","a[data-marionette-event]",function(e){var t=$(this).attr("data-marionette-event");return o.trigger(t),e.stopPropagation(),e.preventDefault(),!1}),o});