define(["marionette","backbone","underscore","handlebars","moment","iecors","translate"],function(e,t,n,r,i){function u(){var e=navigator.userAgent||navigator.vendor||window.opera;return/iPhone|iPod|iPad|Android|BlackBerry|Opera Mini|IEMobile/.test(e)}var s=t.Model.prototype.parse;t.Model.prototype.parse=function(){var e=s.apply(this,arguments),t=/(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})[+-](\d{4})/,r=function(e){n.each(e,function(i,s){n.isString(i)&&t.test(i)?e[s]=new Date(i):n.isObject(i)&&r(e[s])})};return r(e),e},r.registerHelper("formatDate",function(e,t){return i(e).format(t)}),r.registerHelper("relativeFromNow",function(e){return i(e).calendar()}),r.registerHelper("globalVar",function(e){return window[e]});var o=new e.Application;return o.addRegions({headerRegion:"header",leftRegion:"#sidebar",body_container_main_Region:"#body_container_main",container_center_Region:"#body_container_main",body_container_chat_Region:"#body_container_chat",container_left_Region:"#body_container_left"}),o.navigate=function(e,n){n=n||{},t.history.navigate(e,n)},$.ajaxSetup({beforeSend:function(e,t){t.url.indexOf(window.kiwi_server)==-1&&e.setRequestHeader("Authorization","Bearer "+window.token)}}),o.mobile=u(),window.debug_mode?o.root="/app_dev.php/":o.root="/",o.startSubApp=function(e,t){var n=e?o.module(e):null;if(o.currentApp===n)return;o.currentApp&&o.currentApp.stop(),o.currentApp=n,n&&n.start(t)},o.on("initialize:after",function(e){require(["apps/messages/messages_app"],function(){o.vent.trigger("socialapp:loaded")});var t=e.routes||{},n=function(e){var n=e.hash,r=t[n.route]||"";if(typeof n!="undefined")for(param in n)r=r.replace("{"+param+"}",n[param]);return r};r.registerHelper("route",n)}),o.on("start",function(e){require(["text!translations/es.json","text!translations/en.json"],function(t,n){var s="en";typeof e!="undefined"&&typeof e.lang!="undefined"&&(s=e.lang),i.lang(s);var u="{}";s=="es"?u=t:s=="en"&&(u=n);var a=JSON.parse(u),f=window.libTranslate.getTranslationFunction(a),l=function(){return f.apply(null,arguments)};o.reqres.setHandler("trans",l),r.registerHelper("t",l)})}),$(document).on("click","a[data-marionette-event]",function(e){var t=$(this).attr("data-marionette-event");return o.trigger(t),e.stopPropagation(),e.preventDefault(),!1}),o});